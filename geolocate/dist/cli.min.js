#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui under the MIT license.
 *  Source: https://code.geolocatejs.org
 *  Documentation: https://docs.geolocatejs.org
 */
const pkgName="@adamlui/geolocate",copyright="Â© 2024 Adam Lui under the MIT license.",cmdFormat="geolocate [ip1] [ip2] [...] [options|commands]",srcURL="https://code.geolocatejs.org",docURL="https://docs.geolocatejs.org/#-command-line-usage";(async()=>{const e=require(__dirname.match(/src/)?"./geolocate":"./geolocate.min"),n=require("fs"),s=require("path"),i=require("child_process")["execSync"],t="[0m",r="[1;97m";let p="en";if("win32"==process.platform)try{p=i("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){}else{var c=process.env;p=(c.LANG||c.LANGUAGE||c.LC_ALL||c.LC_MESSAGES||c.LC_NAME||"en").split(".")[0]}let a={};var o,c=new Promise((t,r)=>{const c="https://cdn.jsdelivr.net/gh/adamlui/js-utils@3751d3acf7269b5e1e5ae414c7695cacd4eb8bbb/geolocate/_locales/",e=(p?p.replace("-","_"):"en")+"/";let a=c+e+"messages.json",l=0;h(a).then(async function o(e){try{const n=await e.json(),s={};for(const i in n)"object"==typeof n[i]&&"message"in n[i]&&(s[i]=n[i].message);t(s)}catch(e){if(3==++l)return t({});h(a=p.includes("-")&&1==l?a.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):c+"en/messages.json").then(o).catch(r)}}).catch(r)});try{a=await c}catch(e){}const l={},g={flags:{quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(o=>{var e,n;o.startsWith("-")&&(e=Object.keys(g.flags).find(e=>g.flags[e].test(o)),n=Object.keys(g.infoCmds).find(e=>g.infoCmds[e].test(o)),e?l[e]=!0:n||(console.error(`
${"[1;91m"+(a.prefix_error||"ERROR")}: `+`Arg [${o}] ${a.error_notRecognized||"not recognized"}.[0m`),console.info(`
${"[1;33m"+(a.info_validArgs||"Valid arguments are below")}.[0m`),u(["configOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>g.infoCmds.help.test(e)))u();else if(process.argv.some(e=>g.infoCmds.version.test(e))){c=i(`npm view ${pkgName} version`).toString().trim()||"none";let e,o=process.cwd();for(;"/"!=o;){var m=s.join(o,"package.json");if(n.existsSync(m)){m=require(m);e=(m.dependencies?.[pkgName]||m.devDependencies?.[pkgName])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}o=s.dirname(o)}console.info(`
${a.prefix_globalVer||"Global version"}: `+c),console.info(`${a.prefix_localVer||"Local version"}: `+e)}else{var f,d=[];for(const $ of process.argv.slice(2))$.startsWith("-")||(f=$.replace(/[[\]]/g,""),d.push(f));c=await e.locate(d,{verbose:!l.quietMode});c||process.exit(1),l.quietMode||1!=c.length||(console.info(`
IP: `+r+c[0].ip+t),console.info(`${a.geoLabel_country||"Country"}: `+r+c[0].country+t),console.info(`${a.geoLabel_region||"Region"}: `+r+c[0].regionName+t),console.info(`${a.geoLabel_city||"City"}: `+r+c[0].city+t),console.info(`${a.geoLabel_zip||"Zip"}: `+r+c[0].zip+t),console.info(`${a.geoLabel_lat||"Latitude"}: `+r+c[0].lat+t),console.info(`${a.geoLabel_lon||"Longitude"}: `+r+c[0].lon+t),console.info(`${a.geoLabel_timeZone||"Time zone"}: `+r+c[0].timezone.replace(/_/g," ").replace(/\//g," / ")+t),console.info("ISP: "+r+c[0].isp+t)),o=`
${a.info_copying||"Copying to clipboard"}...`,l.quietMode||console.info(o),o=(o=JSON.stringify(c,null,2)).replace(/"/g,'""'),"darwin"==process.platform?i(`printf "${o}" | pbcopy`):"linux"==process.platform?i(`printf "${o}" | xclip -selection clipboard`):"win32"==process.platform&&i(`Set-Clipboard -Value "${o}"`,{shell:"powershell"})}function h(s){return new Promise((n,e)=>{var o=s.match(/^([^:]+):\/\//)[1];/^https?$/.test(o)||e(new Error(`${a.error_invalidURL||"Invalid URL"}.`)),require(o).get(s,e=>{let o="";e.on("data",e=>o+=e),e.on("end",()=>n({json:()=>JSON.parse(o)}))}).on("error",e)})}function u(e=["header","usage","configOptions","infoCmds"]){var o=`[106m[30m ${pkgName.replace(/^@[^/]+\//,"")} [0m `;const n={header:["\nâ”œ "+o+(a.appCopyright||copyright),o+(a.prefix_source||"Source")+": "+srcURL],usage:[`
${r}o ${a.helpSection_usage||"Usage"}:[0m`," [1;97mÂ» [1;92m"+cmdFormat+t],configOptions:[`
${r}o ${a.helpSection_configOptions||"Config options"}:[0m`,` -q, --quiet                 ${a.optionDesc_quiet||"Suppress all logging except errors"}.`],infoCmds:[`
${r}o ${a.helpSection_infoCmds||"Info commands"}:[0m`," -h, --help                  "+(a.optionDesc_help||"Display help screen."),` -v, --version               ${a.optionDesc_version||"Show version number"}.`]};e.forEach(r=>{n[r]?.forEach(e=>{{var s=/header|usage/.test(r)?1:29;const i=process.stdout.columns||80,t=[],o=e.match(/\S+|\s+/g);let n="";o.forEach(e=>{var o=i-(0==t.length?0:s);n.length+"| ".length+e.length>o&&(t.push(0==t.length?n:n.trimStart()),n=""),n+=e}),t.push(0==t.length?n:n.trimStart()),t.forEach((e,o)=>console.info("| "+(0==o?e:" ".repeat(s)+e)))}})}),console.info(`
${a.info_moreHelp||"For more help"}, ${a.info_visit||"visit"}: `+r+docURL+t)}})();