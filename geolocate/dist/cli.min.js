#!/usr/bin/env node
(async()=>{const e=require(__dirname.match(/src/)?"./geolocate":"./geolocate.min"),o=require("generate-ip")["ipv4"],s=require("child_process")["execSync"],r="[1;33m",t={},n={flags:{quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(o=>{var e,s;o.startsWith("-")&&(e=Object.keys(n.flags).find(e=>n.flags[e].test(o)),s=Object.keys(n.infoCmds).find(e=>n.infoCmds[e].test(o)),e?t[e]=!0:s||(console.error(`
[1;91mERROR: Arg [${o}] not recognized.[0m`),console.info(`
${r}Valid arguments are below.[0m`),f(["flags","infoCmds"]),process.exit(1)))}),process.argv.some(e=>n.infoCmds.help.test(e)))f();else if(process.argv.some(e=>n.infoCmds.version.test(e)))console.info("v"+require("./package.json").version);else{var i,a=process.argv.slice(2),l=[];for(let e=0;e<a.length;e++)a[e].startsWith("-")||(o.validate(a[e],{verbose:!1})?l.push(a[e]):(i=0==e?"st":1==e?"nd":"th",console.error(`ERROR: ${e+1+i} arg '${a[e]}' is not a valid IPv4 address.`),console.info("Type 'geolocate --help' for help."),process.exit(1)));0==l.length&&l.push(await e.getOwnIP()),l.forEach(e=>g(`Fetching geolocation data for ${e}...`));var c=[];for(const h of l)c.push(await e.locate(h));1==c.length&&g(c[0]),g("Copying to clipboard..."),p=(p=JSON.stringify(c)).replace(/\s+$/,"").replace(/"/g,'""'),"darwin"===process.platform?s(`printf "${p}" | pbcopy`):"linux"===process.platform?s(`printf "${p}" | xclip -selection clipboard`):"win32"===process.platform&&s(`Set-Clipboard -Value "${p}"`,{shell:"powershell"})}var p;function f(e=["cmdFormat","flags","infoCmds"]){const o={cmdFormat:[`
${r}geolocate [ip] [options|commands][0m`],flags:["\nBoolean options:"," -q, --quiet                 Suppress all logging except errors."],infoCmds:["\nInfo commands:"," -h, --help                  Display help screen."," -v, --version               Show version number."]};e.forEach(e=>{o[e]?.forEach(e=>{{const r=process.stdout.columns||80,t=[],o=e.match(/\S+|\s+/g);let s="";o.forEach(e=>{var o=r-(0===t.length?0:29);s.length+e.length>o&&(t.push(0===t.length?s:s.trimStart()),s=""),s+=e}),t.push(0===t.length?s:s.trimStart()),t.forEach((e,o)=>console.info(0===o?e:" ".repeat(29)+e))}})})}function g(e){t.quietMode||console.info(e)}})();