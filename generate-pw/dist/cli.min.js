#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.js-utils.com/generate-pw
 *  Documentation: https://docs.js-utils.com/generate-pw
 */
const pkgName="generate-pw",copyright="Â© 2024 Adam Lui & contributors under the MIT license.",cmdFormat="generate-pw [options|commands]",srcURL="https://code.js-utils.com/generate-pw",docURL="https://docs.js-utils.com/generate-pw/#-command-line-usage";(async()=>{const e=require(__dirname.match(/src/)?"./generate-pw":"./generate-pw.min")["generatePassword"],o=require("fs"),r=require("path"),n=require("child_process")["execSync"],t="[0m",a="[1;91m",i="[1;97m";let p="en";if("win32"==process.platform)try{p=n("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){}else{var c=process.env;p=(c.LANG||c.LANGUAGE||c.LC_ALL||c.LC_MESSAGES||c.LC_NAME||"en").split(".")[0]}let l={};var s,c=new Promise((t,a)=>{const i="https://raw.githubusercontent.com/adamlui/js-utils/main/generate-pw/_locales/",e=(p?p.replace("-","_"):"en")+"/";let c=i+e+"messages.json",l=0;h(c).then(async function s(e){try{const o=await e.json(),r={};for(const n in o)"object"==typeof o[n]&&"message"in o[n]&&(r[n]=o[n].message);t(r)}catch(e){if(3==++l)return t({});h(c=p.includes("-")&&1==l?c.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):i+"en/messages.json").then(s).catch(a)}}).catch(a)});try{l=await c}catch(e){}const m={},d={paramOptions:{length:/^--?length(?:=.*|$)/,qty:/^--?qu?a?n?ti?t?y(?:=.*|$)/,charset:/^--?charse?t?(?:=.*|$)/,excludeChars:/^--?exclude(?:=.*|$)/},flags:{includeNums:/^--?(?:n|(?:include-?)?num(?:ber)?s?=?(?:true|1)?)$/,includeSymbols:/^--?(?:y|(?:include-?)?symbols?=?(?:true|1)?)$/,excludeLowerChars:/^--?(?:L|(?:exclude|disable|no)-?lower-?(?:case)?|lower-?(?:case)?=(?:false|0))$/,excludeUpperChars:/^--?(?:U|(?:exclude|disable|no)-?upper-?(?:case)?|upper-?(?:case)?=(?:false|0))$/,excludeSimilarChars:/^--?(?:S|(?:exclude|disable|no)-?similar-?(?:char(?:acter)?s?)?|similar-?(?:char(?:acter)?s?)?=(?:false|0))$/,strictMode:/^--?s(?:trict)?(?:-?mode)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(s=>{var e,o,r;s.startsWith("-")&&(e=Object.keys(d.paramOptions).find(e=>d.paramOptions[e].test(s)),r=Object.keys(d.flags).find(e=>d.flags[e].test(s)),o=Object.keys(d.infoCmds).find(e=>d.infoCmds[e].test(s)),r?m[r]=!0:e?(s.includes("=")||(console.error(`
${a+(l.prefix_error||"ERROR")}: `+`Arg [--${s.replace(/-/g,"")}] `+`${l.error_noEqual||"requires '=' followed by a value"}.${t}`),g(),process.exit(1)),r=s.split("=")[1],m[e]=parseInt(r)||r):o||(console.error(`
${a+(l.prefix_error||"ERROR")}: `+`Arg [${s}] ${l.error_notRecognized||"not recognized"}.[0m`),console.info(`
${"[1;33m"+(l.info_validArgs||"Valid arguments are below")}.[0m`),f(["paramOptions","flags","infoCmds"]),process.exit(1)))}),process.argv.some(e=>d.infoCmds.help.test(e)))f();else if(process.argv.some(e=>d.infoCmds.version.test(e))){c=n(`npm view ${pkgName} version`).toString().trim()||"none";let e,s=process.cwd();for(;"/"!=s;){var u=r.join(s,"package.json");if(o.existsSync(u)){u=require(u);e=(u.dependencies?.[pkgName]||u.devDependencies?.[pkgName])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}s=r.dirname(s)}console.info(`
${l.prefix_globalVer||"Global version"}: `+c),console.info(`${l.prefix_localVer||"Local version"}: `+e)}else{for(const $ of["length","qty"])m[$]&&(isNaN(m[$])||m[$]<1)&&(console.error(`
${a+(l.prefix_error||"ERROR")}: [${$}] `+`${l.error_nonPositiveNum||"argument can only be > 0"}.${t}`),g(),process.exit(1));c={length:m.length||8,qty:m.qty||1,charset:m.charset,exclude:m.excludeChars,numbers:!!m.includeNums,symbols:!!m.includeSymbols,lowercase:!m.excludeLowerChars,uppercase:!m.excludeUpperChars,excludeSimilarChars:!!m.excludeSimilarChars,strict:!!m.strictMode,verbose:!m.quietMode},c=e(c);s=`
${l.info_copying||"Copying to clipboard"}...`,m.quietMode||console.info(s),s=(s=Array.isArray(c)?c.join("\n"):c).replace(/"/g,'""'),"darwin"==process.platform?n(`printf "${s}" | pbcopy`):"linux"==process.platform?n(`printf "${s}" | xclip -selection clipboard`):"win32"==process.platform&&n(`Set-Clipboard -Value "${s}"`,{shell:"powershell"})}function h(r){return new Promise((o,e)=>{var s=r.match(/^([^:]+):\/\//)[1];/^https?$/.test(s)||e(new Error(`${l.error_invalidURL||"Invalid URL"}.`)),require(s).get(r,e=>{let s="";e.on("data",e=>s+=e),e.on("end",()=>o({json:()=>JSON.parse(s)}))}).on("error",e)})}function f(e=["header","usage","paramOptions","flags","infoCmds"]){var s=`[106m[30m ${pkgName} [0m `;const o={header:["\nâ”œ "+s+(l.appCopyright||copyright),s+(l.prefix_source||"Source")+": "+srcURL],usage:[`
${i}o ${l.helpSection_usage||"Usage"}:[0m`," [1;97mÂ» [1;92m"+cmdFormat+t],paramOptions:[`
${i}o ${l.helpSection_paramOptions||"Parameter options"}:[0m`,` --length=n                  ${l.optionDesc_length||"Generate password(s) of n length"}.`,` --qty=n                     ${l.optionDesc_qty||"Generate n password(s)"}.`,` --charset=chars             ${l.optionDesc_charset||"Only include chars in password(s)"}.`,` --exclude=chars             ${l.optionDesc_exclude||"Exclude chars from password(s)"}.`],flags:[`
${i}o ${l.helpSection_flags||"Boolean options"}:[0m`,` -n, --include-numbers       ${l.optionDesc_includeNums||"Allow numbers in password(s)"}.`,` -y, --include-symbols       ${l.optionDesc_includeSymbols||"Allow symbols in password(s)"}.`,` -L, --no-lowercase          ${l.optionDesc_noLower||"Disallow lowercase letters in password(s)"}.`,` -U, --no-uppercase          ${l.optionDesc_noUpper||"Disallow uppercase letters in password(s)"}.`,` -S, --no-similar            ${l.optionDesc_noSimilar||"Exclude similar characters in password(s)"}.`,` -s, --strict                ${l.optionDesc_strict||"Require at least one character from eachallowed character set in password(s)"}.`,` -q, --quiet                 ${l.optionDesc_quiet||"Suppress all logging except errors"}.`],infoCmds:[`
${i}o ${l.helpSection_infoCmds||"Info commands"}:[0m`," -h, --help                  "+(l.optionDesc_help||"Display help screen."),` -v, --version               ${l.optionDesc_version||"Show version number"}.`]};e.forEach(a=>{o[a]?.forEach(e=>{{var r=/header|usage/.test(a)?1:29;const n=process.stdout.columns||80,t=[],s=e.match(/\S+|\s+/g);let o="";s.forEach(e=>{var s=n-(0==t.length?0:r);o.length+"| ".length+e.length>s&&(t.push(0==t.length?o:o.trimStart()),o=""),o+=e}),t.push(0==t.length?o:o.trimStart()),t.forEach((e,s)=>console.info("| "+(0==s?e:" ".repeat(r)+e)))}})}),console.info(`
${l.info_moreHelp||"For more help"}, ${l.info_visit||"visit"}: `+i+docURL+t)}function g(){console.info(`
${l.info_moreHelp||"For more help"},`+` ${l.info_type||"type"} 'generate-pw --help'`+` ${l.info_or||"or"} ${l.info_visit||"visit"}
`+i+docURL+t)}})();