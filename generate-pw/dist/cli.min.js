#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.generatepw.org
 *  Documentation: https://docs.generatepw.org
 */
const pkgName="generate-pw",copyright="Â© 2024 Adam Lui & contributors under the MIT license.",cmdFormat="generate-pw [options|commands]",srcURL="https://code.generatepw.org",docURL="https://docs.generatepw.org/#-command-line-usage";(async()=>{const e=require(__dirname.match(/src/)?"./generate-pw":"./generate-pw.min")["generatePassword"],r=require("fs"),o=require("path"),n=require("child_process")["execSync"],t="[0m",a="[1;91m",i="[1;97m";let p="en";if("win32"==process.platform)try{p=n("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){}else{var c=process.env;p=(c.LANG||c.LANGUAGE||c.LC_ALL||c.LC_MESSAGES||c.LC_NAME||"en").split(".")[0]}let l={};var s,c=new Promise((t,a)=>{const i="https://cdn.jsdelivr.net/gh/adamlui/js-utils/generate-pw/_locales/",e=(p?p.replace("-","_"):"en")+"/";let c=i+e+"messages.json",l=0;h(c).then(async function s(e){try{const r=await e.json(),o={};for(const n in r)"object"==typeof r[n]&&"message"in r[n]&&(o[n]=r[n].message);t(o)}catch(e){if(3==++l)return t({});h(c=p.includes("-")&&1==l?c.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):i+"en/messages.json").then(s).catch(a)}}).catch(a)});try{l=await c}catch(e){}const d={},m={paramOptions:{length:/^--?length(?:=.*|$)/,qty:/^--?qu?a?n?ti?t?y(?:=.*|$)/,charset:/^--?charse?t?(?:=.*|$)/,excludeChars:/^--?exclude(?:=.*|$)/},flags:{includeNums:/^--?(?:n|(?:include-?)?num(?:ber)?s?=?(?:true|1)?)$/,includeSymbols:/^--?(?:y|(?:include-?)?symbols?=?(?:true|1)?)$/,excludeLowerChars:/^--?(?:L|(?:exclude|disable|no)-?lower-?(?:case)?|lower-?(?:case)?=(?:false|0))$/,excludeUpperChars:/^--?(?:U|(?:exclude|disable|no)-?upper-?(?:case)?|upper-?(?:case)?=(?:false|0))$/,excludeSimilarChars:/^--?(?:S|(?:exclude|disable|no)-?similar-?(?:char(?:acter)?s?)?|similar-?(?:char(?:acter)?s?)?=(?:false|0))$/,strictMode:/^--?s(?:trict)?(?:-?mode)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(s=>{var e,r,o;s.startsWith("-")&&(e=Object.keys(m.paramOptions).find(e=>m.paramOptions[e].test(s)),o=Object.keys(m.flags).find(e=>m.flags[e].test(s)),r=Object.keys(m.infoCmds).find(e=>m.infoCmds[e].test(s)),o?d[o]=!0:e?(s.includes("=")||(console.error(`
${a+(l.prefix_error||"ERROR")}: `+`Arg [--${s.replace(/-/g,"")}] `+`${l.error_noEqual||"requires '=' followed by a value"}.${t}`),f(),process.exit(1)),o=s.split("=")[1],d[e]=parseInt(o)||o):r||(console.error(`
${a+(l.prefix_error||"ERROR")}: `+`Arg [${s}] ${l.error_notRecognized||"not recognized"}.[0m`),console.info(`
${"[1;33m"+(l.info_validArgs||"Valid arguments are below")}.[0m`),g(["paramOptions","flags","infoCmds"]),process.exit(1)))}),process.argv.some(e=>m.infoCmds.help.test(e)))g();else if(process.argv.some(e=>m.infoCmds.version.test(e))){c=n(`npm view ${pkgName} version`).toString().trim()||"none";let e,s=process.cwd();for(;"/"!=s;){var u=o.join(s,"package.json");if(r.existsSync(u)){u=require(u);e=(u.dependencies?.[pkgName]||u.devDependencies?.[pkgName])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}s=o.dirname(s)}console.info(`
${l.prefix_globalVer||"Global version"}: `+c),console.info(`${l.prefix_localVer||"Local version"}: `+e)}else{for(const $ of["length","qty"])d[$]&&(isNaN(d[$])||d[$]<1)&&(console.error(`
${a+(l.prefix_error||"ERROR")}: [${$}] `+`${l.error_nonPositiveNum||"argument can only be > 0"}.${t}`),f(),process.exit(1));c={length:d.length||8,qty:d.qty||1,charset:d.charset,exclude:d.excludeChars,numbers:!!d.includeNums,symbols:!!d.includeSymbols,lowercase:!d.excludeLowerChars,uppercase:!d.excludeUpperChars,excludeSimilarChars:!!d.excludeSimilarChars,strict:!!d.strictMode,verbose:!d.quietMode},c=e(c);s=`
${l.info_copying||"Copying to clipboard"}...`,d.quietMode||console.info(s),s=(s=Array.isArray(c)?c.join("\n"):c).replace(/"/g,'""'),"darwin"==process.platform?n(`printf "${s}" | pbcopy`):"linux"==process.platform?n(`printf "${s}" | xclip -selection clipboard`):"win32"==process.platform&&n(`Set-Clipboard -Value "${s}"`,{shell:"powershell"})}function h(o){return new Promise((r,e)=>{var s=o.match(/^([^:]+):\/\//)[1];/^https?$/.test(s)||e(new Error(`${l.error_invalidURL||"Invalid URL"}.`)),require(s).get(o,e=>{let s="";e.on("data",e=>s+=e),e.on("end",()=>r({json:()=>JSON.parse(s)}))}).on("error",e)})}function g(e=["header","usage","paramOptions","flags","infoCmds"]){var s=`[106m[30m ${pkgName} [0m `;const r={header:["\nâ”œ "+s+(l.appCopyright||copyright),s+(l.prefix_source||"Source")+": "+srcURL],usage:[`
${i}o ${l.helpSection_usage||"Usage"}:[0m`," [1;97mÂ» [1;92m"+cmdFormat+t],paramOptions:[`
${i}o ${l.helpSection_paramOptions||"Parameter options"}:[0m`,` --length=n                  ${l.optionDesc_length||"Generate password(s) of n length"}.`,` --qty=n                     ${l.optionDesc_qty||"Generate n password(s)"}.`,` --charset=chars             ${l.optionDesc_charset||"Only include chars in password(s)"}.`,` --exclude=chars             ${l.optionDesc_exclude||"Exclude chars from password(s)"}.`],flags:[`
${i}o ${l.helpSection_flags||"Boolean options"}:[0m`,` -n, --include-numbers       ${l.optionDesc_includeNums||"Allow numbers in password(s)"}.`,` -y, --include-symbols       ${l.optionDesc_includeSymbols||"Allow symbols in password(s)"}.`,` -L, --no-lowercase          ${l.optionDesc_noLower||"Disallow lowercase letters in password(s)"}.`,` -U, --no-uppercase          ${l.optionDesc_noUpper||"Disallow uppercase letters in password(s)"}.`,` -S, --no-similar            ${l.optionDesc_noSimilar||"Exclude similar characters in password(s)"}.`,` -s, --strict                ${l.optionDesc_strict||"Require at least one character from eachallowed character set in password(s)"}.`,` -q, --quiet                 ${l.optionDesc_quiet||"Suppress all logging except errors"}.`],infoCmds:[`
${i}o ${l.helpSection_infoCmds||"Info commands"}:[0m`," -h, --help                  "+(l.optionDesc_help||"Display help screen."),` -v, --version               ${l.optionDesc_version||"Show version number"}.`]};e.forEach(a=>{r[a]?.forEach(e=>{{var o=/header|usage/.test(a)?1:29;const n=process.stdout.columns||80,t=[],s=e.match(/\S+|\s+/g);let r="";s.forEach(e=>{var s=n-(0==t.length?0:o);r.length+"| ".length+e.length>s&&(t.push(0==t.length?r:r.trimStart()),r=""),r+=e}),t.push(0==t.length?r:r.trimStart()),t.forEach((e,s)=>console.info("| "+(0==s?e:" ".repeat(o)+e)))}})}),console.info(`
${l.info_moreHelp||"For more help"}, ${l.info_visit||"visit"}: `+i+docURL+t)}function f(){console.info(`
${l.info_moreHelp||"For more help"},`+` ${l.info_type||"type"} 'generate-pw --help'`+` ${l.info_or||"or"} ${l.info_visit||"visit"}
`+i+docURL+t)}})();