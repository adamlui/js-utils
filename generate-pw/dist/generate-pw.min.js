#!/usr/bin/env node
const m=require("crypto")["randomInt"],r=require("child_process")["execSync"],g={lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",numbers:"0123456789",symbols:"!@#$%^&*()-_=+[]{}/\\|;:'\",.<>?"};function a(o={}){var e,r={length:8,qty:1,charset:"",exclude:"",numbers:!1,symbols:!1,lowercase:!0,uppercase:!0,strict:!1};o={...r,...o};for(const s of Object.keys(o))if(!Object.prototype.hasOwnProperty.call(r,s))return console.error(`generatePassword() Â» ERROR: \`${s}\` is an invalid option.
`+`generatePassword() Â» Valid options:
  [ ${Object.keys(r).join(", ")} ]`);for(const n of["length","qty"])if(o[n]=parseInt(o[n],10),isNaN(o[n])||o[n]<1)return console.error(`generatePassword() Â» ERROR: [${n}] option can only be an integer > 0.`);for(const a of["numbers","symbols","lowercase","uppercase","strict"])if("boolean"!=typeof o[a])return console.error(`generatePassword() Â» ERROR: [${a}] option can only be \`true\` or \`false\`.`);if(1<o.qty){const{qty:l,...i}=o;return c(l,i)}{let r=o.charset||(o.numbers?g.numbers:"")+(o.symbols?g.symbols:"")+(o.lowercase?g.lower:"")+(o.uppercase?g.upper:""),s=(r=(r=""===r?g.lower+g.upper:r).replace(new RegExp(`[${o.exclude}]`,"g"),""),"");for(let e=0;e<o.length;e++){var t=m(0,r.length);s+=r.charAt(t)}return o.strict&&(e=["number","symbol","lower","upper"].filter(e=>o[e+"s"]||o[e+"case"]),s=p(s,e)),s}}function c(r,s={}){var e={length:8,charset:"",exclude:"",numbers:!1,symbols:!1,lowercase:!0,uppercase:!0,strict:!1};if(s={...e,...s},r=parseInt(r,10),isNaN(r)||r<1)return console.error("generatePasswords() Â» ERROR: 1st arg [qty] can only be an integer > 0.");for(const t of Object.keys(s))if(!Object.prototype.hasOwnProperty.call(e,t))return console.error(`generatePasswords() Â» ERROR: \`${t}\` is an invalid option.
`+`generatePasswords() Â» Valid options:
  [ ${Object.keys(e).join(", ")} ]`);if(s.length=parseInt(s.length),isNaN(s.length)||s.length<1)return console.error("generatePasswords() Â» ERROR: [length] option can only be an integer > 0.");for(const n of["numbers","symbols","lowercase","uppercase","strict"])if("boolean"!=typeof s[n])return console.error(`generatePasswords() Â» ERROR: [${n}] option can only be \`true\` or \`false\`.`);var o=[];for(let e=0;e<r;e++)o.push(a(s));return o}function p(r,s=["number","symbol","lower","upper"],e={}){var o={verbose:!0};if(e={...o,...e},"string"!=typeof r)return console.error("strictify() Â» ERROR: 1st arg <password> must be a string.");var t=["number","symbol","lower","upper"];for(const p of s)if(!t.includes(p))return console.error(`strictify() Â» ERROR: \`${p}\` is an invalid character type.
`+`strictify() Â» Valid character types: [ ${t.join(", ")} ]`);for(const f of Object.keys(e)){if(!Object.prototype.hasOwnProperty.call(o,f))return console.error(`strictify() Â» ERROR: \`${f}\` is an invalid option.
`+`strictify() Â» Valid options: [ ${Object.keys(o).join(", ")} ]`);if("boolean"!=typeof e[f])return console.error(`strictify() Â» ERROR: \`${f}\` option can only be set to \`true\` or \`false\`.`)}for(const u of s)global["has"+u.charAt(0).toUpperCase()+u.slice(1)]=!1;for(let e=0;e<r.length;e++)for(const d of s)(g[d]||g[d+"s"]).includes(r.charAt(e))&&(global["has"+d.charAt(0).toUpperCase()+d.slice(1)]=!0);e.verbose&&console.info("strictify() Â» Strictifying password...");var n=Math.min(r.length,s.length),a=[];let l=0,i=r;for(const h of s)if(l<n&&!global["has"+h.charAt(0).toUpperCase()+h.slice(1)]){let e;for(;e=m(0,r.length),a.includes(e););a.push(e);var c=g[h]||g[h+"s"];i=i.substring(0,e)+c.charAt(m(0,c.length))+i.substring(e+1),l++}return e.verbose&&(0<l?console.info("strictify() Â» Strictification complete!"):console.info(`strictify() Â» Password already includes ${s.join(" + ")} characters!
`+"strictify() Â» No modifications made.")),i}function e(e,r={}){var s={minLength:8,minLower:1,minUpper:1,minNumber:1,minSymbol:1},o={verbose:!0};if(r={...o,...r},"string"!=typeof e)return console.error("validateStrength() Â» ERROR: 1st arg <password> must be a string.");for(const l of Object.keys(r)){if(!Object.prototype.hasOwnProperty.call(o,l))return console.error(`validateStrength() Â» ERROR: \`${l}\` is an invalid option.
`+`validateStrength() Â» Valid options: [ ${Object.keys(o).join(", ")} ]`);if("boolean"!=typeof r[l])return console.error(`validateStrength() Â» ERROR: \`${l}\` option can only be set to \`true\` or \`false\`.`)}r.verbose&&console.info("validateStrength() Â» Validating password strength...");var t={lower:0,upper:0,number:0,symbol:0};for(const i of e)for(const c of Object.keys(t))(g[c]||g[c+"s"]).includes(i)&&t[c]++;var n=[];e.length<s.minLength&&n.push(`Make it at least ${s.minLength} characters long.`);for(const p of Object.keys(t))t[p]<s["min"+p.charAt(0).toUpperCase()+p.slice(1)]&&n.push("Include at least one "+p+`${["upper","lower"].includes(p)?"case letter":""}.`);let a=0;a+=e.length>=s.minLength?20:0;for(const f of Object.keys(t))a+=t[f]>=s["min"+f.charAt(0).toUpperCase()+f.slice(1)]?20:0;return r.verbose&&console.info("validateStrength() Â» Password strength validated!\n"+(require.main!==module?"validateStrength() Â» Check returned object for score/recommendations.":"")),{strengthScore:a,recommendations:n,isGood:80<=a}}if(require.main!==module)module.exports={generatePassword:a,generatePasswords:c,strictify:p,validateStrength:e};else{const n="[0m",l="[1;91m",i="[1;33m",f={},u={paramOptions:{length:/^--?length/,qty:/^--?qu?a?n?ti?t?y=.*$/,charset:/^--?chars/,excludeChars:/^--?exclude=/},flags:{includeNums:/^--?(?:n|(?:include-?)?num(?:ber)?s?=?(?:true|1)?)$/,includeSymbols:/^--?(?:s|(?:include-?)?symbols?=?(?:true|1)?)$/,excludeLowerChars:/^--?(?:L|(?:exclude|disable|no)-?lower-?(?:case)?|lower-?(?:case)?=(?:false|0))$/,excludeUpperChars:/^--?(?:U|(?:exclude|disable|no)-?upper-?(?:case)?|upper-?(?:case)?=(?:false|0))$/,strictMode:/^--?s(?:trict)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(r=>{var e,s,o;r.startsWith("-")&&(e=Object.keys(u.paramOptions).find(e=>u.paramOptions[e].test(r)),o=Object.keys(u.flags).find(e=>u.flags[e].test(r)),s=Object.keys(u.infoCmds).find(e=>u.infoCmds[e].test(r)),o?f[o]=!0:e?(o=r.split("=")[1],f[e]=parseInt(o)||o):s||(console.error(`
${l}ERROR: Arg [${r}] not recognized.`+n),console.info(`
${i}Valid arguments are below.`+n),t(["paramOptions","flags","infoCmds"]),process.exit(1)))}),process.argv.some(e=>u.infoCmds.help.test(e)))t();else if(process.argv.some(e=>u.infoCmds.version.test(e)))console.info("v"+require("./package.json").version);else{for(const h of["length","qty"])f[h]&&(isNaN(f[h])||f[h]<1)&&(console.error(`
${l}Error: [${h}] argument can only be > 0.`+n),process.exit(1));const o={length:f.length||8,qty:f.qty||1,charset:f.charset,exclude:f.excludeChars,numbers:!!f.includeNums,symbols:!!f.includeSymbols,lowercase:!f.excludeLowerChars,uppercase:!f.excludeUpperChars,strict:!!f.strictMode},d=a(o);s(Array.isArray(d)?d.join("\n"):d)}function t(e=["cmdFormat","paramOptions","flags","infoCmds"]){const r={cmdFormat:[`
${i}generate-pw [options|commands]`+n],paramOptions:["\nParameter options:"," --length=n                  Generate password(s) of n length."," --qty=n                     Generate n password(s)."," --charset=chars             Only include chars in password(s)."," --charset=chars             Only include chars in password(s)."," --exclude=chars             Exclude chars from password(s)."],flags:["\nBoolean options:"," -n, --include-numbers       Allow numbers in password(s)."," -s, --include-symbols       Allow symbols in password(s)."," -L, --no-lowercase          Disallow lowercase letters in password(s)."," -U, --no-uppercase          Disallow uppercase letters in password(s)."],infoCmds:["\nInfo commands:"," -h, --help                  Display help screen."," -v, --version               Show version number."]};e.forEach(e=>{r[e]?.forEach(e=>{{const o=process.stdout.columns||80,t=[],r=e.match(/\S+|\s+/g);let s="";r.forEach(e=>{var r=o-(0===t.length?0:29);s.length+e.length>r&&(t.push(0===t.length?s:s.trimStart()),s=""),s+=e}),t.push(0===t.length?s:s.trimStart()),t.forEach((e,r)=>console.info(0===r?e:" ".repeat(29)+e))}})})}function s(e){e=e.replace(/\s+$/m,"").replace(/"/g,'""'),"darwin"===process.platform?r(`printf "${e}" | pbcopy`):"linux"===process.platform?r(`printf "${e}" | xclip -selection clipboard`):"win32"===process.platform&&r(`Set-Clipboard -Value "${e}"`,{shell:"powershell"})}}