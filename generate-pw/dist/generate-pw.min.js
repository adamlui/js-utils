#!/usr/bin/env node
const p=require("crypto")["randomInt"],s=require("child_process")["execSync"],u={lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",numbers:"0123456789",symbols:"!@#$%^&*()-_=+[]{}/\\|;:'\",.<>?"};function a(o={}){var e,s={length:8,qty:1,charset:"",exclude:"",numbers:!1,symbols:!1,lowercase:!0,uppercase:!0,strict:!1};o={...s,...o};for(const r of Object.keys(o))if(!Object.prototype.hasOwnProperty.call(s,r))return console.error(`generatePassword() Â» ERROR: \`${r}\` is an invalid option.`+`
generatePassword() Â» Valid options:
  [ ${Object.keys(s).join(", ")} ]`);for(const n of["length","qty"])if(isNaN(o[n])||o[n]<1)return console.error(`generatePassword() Â» ERROR: [${n}] option must be > 1.`);for(const a of["numbers","symbols","lowercase","uppercase","strict"])if("boolean"!=typeof o[a])return console.error(`generatePassword() Â» ERROR: [${a}] option can only be \`true\` or \`false\`.`);if(1<o.qty){const{qty:l,...c}=o;return i(l,c)}{let s=o.charset||(o.numbers?u.numbers:"")+(o.symbols?u.symbols:"")+(o.lowercase?u.lower:"")+(o.uppercase?u.upper:""),r=(s=(s=""===s?u.lower+u.upper:s).replace(new RegExp(`[${o.exclude}]`,"g"),""),"");for(let e=0;e<o.length;e++){var t=p(0,s.length);r+=s.charAt(t)}return o.strict&&(e=["number","symbol","lower","upper"].filter(e=>o[e+"s"]||o[e+"case"]),r=m(r,e)),r}}function i(s,r={}){var e={length:8,qty:1,charset:"",exclude:"",numbers:!1,symbols:!1,lowercase:!0,uppercase:!0,strict:!1};if(r={...e,...r},s=parseInt(s),isNaN(s))return console.error("generatePasswords() Â» ERROR: First argument [qty] of generatePasswords() must be an integer");for(const t of Object.keys(r))if(!Object.prototype.hasOwnProperty.call(e,t))return console.error(`generatePasswords() Â» ERROR: \`${t}\` is an invalid option.`+`
generatePassword() Â» Valid options:
  [ ${Object.keys(e).join(", ")} ]`);if(isNaN(r.length)||r.length<1)return console.error("generatePasswords() Â» ERROR: [length] options must be > 1.");for(const n of["numbers","symbols","lowercase","uppercase","strict"])if("boolean"!=typeof r[n])return console.error(`generatePasswords() Â» ERROR: [${n}] option can only be \`true\` or \`false\`.`);var o=[];for(let e=0;e<s;e++)o.push(a(r));return o}function m(s,r=["number","symbol","lower","upper"]){for(const l of r)global["has"+l.charAt(0).toUpperCase()+l.slice(1)]=!1;for(let e=0;e<s.length;e++)for(const c of r)(u[c]||u[c+"s"]).includes(s.charAt(e))&&(global["has"+c.charAt(0).toUpperCase()+c.slice(1)]=!0);var e=Math.min(s.length,r.length),o=[];let t=0,n=s;for(const i of r)if(t<e&&!global["has"+i.charAt(0).toUpperCase()+i.slice(1)]){let e;for(;e=p(0,s.length),o.includes(e););o.push(e);var a=u[i]||u[i+"s"];n=n.substring(0,e)+a.charAt(p(0,a.length))+n.substring(e+1),t++}return n}function e(e){var s={minLength:8,minLower:1,minUpper:1,minNumber:1,minSymbol:1},r={lower:0,upper:0,number:0,symbol:0};for(const n of e)for(const a of Object.keys(r))(u[a]||u[a+"s"]).includes(n)&&r[a]++;var o=[];e.length<s.minLength&&o.push(`Make it at least ${s.minLength} characters long.`);for(const l of Object.keys(r))r[l]<s["min"+l.charAt(0).toUpperCase()+l.slice(1)]&&o.push("Include at least one "+l+`${["upper","lower"].includes(l)?"case letter":""}.`);let t=0;t+=e.length>=s.minLength?20:0;for(const c of Object.keys(r))t+=r[c]>=s["min"+c.charAt(0).toUpperCase()+c.slice(1)]?20:0;return{strengthScore:t,recommendations:o,isGood:80<=t}}if(require.main!==module)module.exports={generatePassword:a,generatePasswords:i,strictify:m,validateStrength:e};else{const n="[0m",l="[1;91m",c="[1;33m",h={},d={paramOptions:{length:/^--?length/,qty:/^--?qu?a?n?ti?t?y=.*$/,charset:/^--?chars/,excludeChars:/^--?exclude=/},flags:{includeNums:/^--?(?:n|(?:include-?)?num(?:ber)?s?=?(?:true|1)?)$/,includeSymbols:/^--?(?:s|(?:include-?)?symbols?=?(?:true|1)?)$/,excludeLowerChars:/^--?(?:L|(?:exclude|disable|no)-?lower-?(?:case)?|lower-?(?:case)?=(?:false|0))$/,excludeUpperChars:/^--?(?:U|(?:exclude|disable|no)-?upper-?(?:case)?|upper-?(?:case)?=(?:false|0))$/,strictMode:/^--?s(?:trict)?(?:-?mode)?$/},cmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(s=>{var e,r,o;s.startsWith("-")&&(o=Object.keys(d.flags).find(e=>d.flags[e].test(s)),e=Object.keys(d.paramOptions).find(e=>d.paramOptions[e].test(s)),r=Object.keys(d.cmds).find(e=>d.cmds[e].test(s)),o?h[o]=!0:e?(o=s.split("=")[1],h[e]=parseInt(o)||o):r||(console.error(`
${l}ERROR: Arg [${s}] not recognized.`+n),console.info(`
${c}Valid arguments are below.`+n),t(["paramOptions","booelanOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>/^--?h(?:elp)?$/.test(e)))t();else if(process.argv.some(e=>/^--?ve?r?s?i?o?n?$/.test(e)))console.info("v"+require("./package.json").version);else{for(const g of["length","qty"])h[g]&&(isNaN(h[g])||h[g]<1)&&(console.error(`
${l}Error: [${g}] argument must be > 1.`+n),process.exit(1));const o={length:h.length||8,qty:h.qty||1,charset:h.charset,exclude:h.excludeChars,numbers:!!h.includeNums,symbols:!!h.includeSymbols,lowercase:!h.excludeLowerChars,uppercase:!h.excludeUpperChars,strict:!!h.strictMode},f=a(o);r(Array.isArray(f)?f.join("\n"):f)}function t(e=["cmdFormat","paramOptions","booelanOptions","infoCmds"]){const s={cmdFormat:[`
${c}generate-pw [options|commands]`+n],paramOptions:["\nParameter options:"," --length=n                  Generate password(s) of n length."," --qty=n                     Generate n password(s)."," --charset=chars             Only include chars in password(s)."," --charset=chars             Only include chars in password(s)."," --exclude=chars             Exclude chars from password(s)."],booelanOptions:["\nBoolean options:"," -n, --include-numbers       Allow numbers in password(s)."," -s, --include-symbols       Allow symbols in password(s)."," -L, --no-lowercase          Disallow lowercase letters in password(s)."," -U, --no-uppercase          Disallow uppercase letters in password(s)."],infoCmds:["\nInfo commands:"," -h, --help                  Display help screen."," -v, --version               Show version number."]};e.forEach(e=>{s[e]?.forEach(e=>{{const o=process.stdout.columns||80,t=[],s=e.match(/\S+|\s+/g);let r="";s.forEach(e=>{var s=o-(0===t.length?0:29);r.length+e.length>s&&(t.push(0===t.length?r:r.trimStart()),r=""),r+=e}),t.push(0===t.length?r:r.trimStart()),t.forEach((e,s)=>console.info(0===s?e:" ".repeat(29)+e))}})})}function r(e){e=e.replace(/\s+$/m,"").replace(/"/g,'""'),"darwin"===process.platform?s(`printf "${e}" | pbcopy`):"linux"===process.platform?s(`printf "${e}" | xclip -selection clipboard`):"win32"===process.platform&&s(`Set-Clipboard -Value "${e}"`,{shell:"powershell"})}}