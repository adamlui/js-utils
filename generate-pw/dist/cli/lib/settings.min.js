/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/js-utils/tree/main/generate-pw/src
 * Documentation: https://github.com/adamlui/js-utils/tree/main/generate-pw/docs
 */
let fs=require("fs"),log=require(`./log${env.devMode?"":".min"}.js`),path=require("path");(globalThis.app??={}).config={},module.exports={configFilename:"generate-pw.config.mjs",controls:{length:{type:"param",defaultVal:12,regex:/^--?length(?:=.*|$)/},qty:{type:"param",defaultVal:1,regex:/^--?qu?a?n?ti?t?y(?:=.*|$)/},weak:{type:"flag",mode:!0,regex:/^--?weak$/},basic:{type:"flag",mode:!0,regex:/^--?basic$/},strong:{type:"flag",mode:!0,regex:/^--?strong$/},charset:{type:"param",regex:/^--?charse?t?(?:=.*|$)/},excludeChars:{type:"param",regex:/^--?exclude(?:=.*|$)/},config:{type:"param",regex:/^--?config(?:=.*|$)/},excludeNums:{type:"flag",regex:/^--?(?:N|(?:exclude|disable|no)-?num(?:ber)?s?=?(?:true|1)?)$/},excludeSymbols:{type:"flag",regex:/^--?(?:Y|(?:exclude|disable|no)-?symbols?=?(?:true|1)?)$/},excludeLowerChars:{type:"flag",regex:/^--?(?:L|(?:exclude|disable|no)-?lower-?(?:case)?|lower-?(?:case)?=(?:false|0))$/},excludeUpperChars:{type:"flag",regex:/^--?(?:U|(?:exclude|disable|no)-?upper-?(?:case)?|upper-?(?:case)?=(?:false|0))$/},similarChars:{type:"flag",regex:/^--?(?:s|(?:include-?)?similar-?chars?=?(?:true|1)?)$/},unstrict:{type:"flag",regex:/^--?(?:S|(?:un-?strict)?(?:-?mode)?)$/},entropy:{type:"flag",regex:/^--?e(?:ntropy)?$/},quietMode:{type:"flag",regex:/^--?q(?:uiet)?(?:-?mode)?$/},init:{type:"cmd",regex:/^-{0,2}i(?:nit)?$/},help:{type:"cmd",regex:/^--?h(?:elp)?$/},version:{type:"cmd",regex:/^--?ve?r?s?i?o?n?$/}},async initConfigFile(r=this.configFilename){var e=path.resolve(process.cwd(),r);if(fs.existsSync(e))return log.warn(app.msgs.warn_configFileExists+":",e);var s=path.resolve(__dirname,"../../"+(env.devMode?"../":"./data/")+r);if(fs.existsSync(s))fs.copyFileSync(s,e);else{s=require(`./data${env.devMode?"":".min"}.js`),r=app.urls.jsdelivr+"/generate-pw/"+r;log.data(app.msgs.info_fetchingRemoteConfigFrom+` ${r}...`);try{var t=await s.fetch(r);if(!t.ok)return log.warn(`${app.msgs.warn_remoteConfigNotFound}: ${r} (${t.status})`);s.atomicWrite(e,await t.text())}catch(e){return log.warn(app.msgs.warn_remoteConfigFailed+`: ${r} `+e.message)}}log.success(app.msgs.info_configFileCreated+`: ${e}
`),log.tip(app.msgs.tip_editToSetDefaults+"."),log.tip(app.msgs.tip_cliArgsPrioritized+".")},load({args:e=process.argv.slice(2),ctrlKeys:a=Object.keys(this.controls)}={}){a.forEach(e=>{var r=this.controls[e];r.mode||"cmd"==r.type||(app.config[e]??=r.defaultVal??("flag"!=r.type&&""))});let r=null;var s=e.find(e=>this.controls.config.regex.test(e));if(s){/=/.test(s)||log.errorAndExit(`[${s}] `+app.msgs.error_mustIncludePath);s=s.split("=")[1];r=path.isAbsolute(s)?s:path.resolve(process.cwd(),s),fs.existsSync(r)||log.configURLandExit(app.msgs.error_configFileNotFound+":",r)}else for(var t of["mjs","cjs","js"]){t=path.resolve(process.cwd(),this.configFilename.replace(/\.[^.]+$/,"."+t));if(fs.existsSync(t)){r=t;break}}if(r)try{var o=require(r),i=o?.default??o;i&&"object"==typeof i||log.configURLandExit(app.msgs.error_invalidConfigFile+"."),Object.assign(app.config,i)}catch(e){log.configURLandExit(app.msgs.error_failedToLoadConfigFile+":",r,`
`+e.message)}return e.forEach(r=>{if(!/^[^-]|--?(?:config|debug)/.test(r)){var s=a.find(e=>this.controls[e]?.regex?.test(r)),t=(s||log.errorAndExit(`[${r}] ${app.msgs.error_notRecognized}.`),this.controls[s]);if("cmd"!=t.type){let e="param"!=t.type||r.split("=")[1]?.trim();t.mode?app.config.mode=s.replace(/mode$/i,"").toLowerCase():((t=t.parser)&&(e=t(e),isNaN(e)||e<1)&&log.errorAndExit(`[${s}] ${app.msgs.error_nonPositiveNum}.`),app.config[s]=e)}}}),app.config}};