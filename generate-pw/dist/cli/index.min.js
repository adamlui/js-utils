#!/usr/bin/env node
/**
 *  Â© 2024â€“2026 Adam Lui & contributors under the MIT license.
 *  Source: https://code.generatepw.org
 *  Documentation: https://docs.generatepw.org
 */
(async()=>{globalThis.env={devMode:__dirname.match(/[\\/]src/)};var e,s=require("node-clipboardy"),p=require("child_process").execSync,a=require("fs"),o=require(`../generate-pw${env.devMode?"":".min"}.js`).generatePassword,{getMsgs:r,getSysLang:n}=require(`./lib/language${env.devMode?"":".min"}.js`),i=require("path");globalThis.app=require(`../${env.devMode?"../":"./data/"}app.json`),app.urls.docs+="/#-command-line-usage",app.msgs=await r(n()),app.regex={paramOptions:{length:/^--?length(?:=.*|$)/,qty:/^--?qu?a?n?ti?t?y(?:=.*|$)/,charset:/^--?charse?t?(?:=.*|$)/,excludeChars:/^--?exclude(?:=.*|$)/},flags:{includeNums:/^--?(?:n|(?:include-?)?num(?:ber)?s?=?(?:true|1)?)$/,includeSymbols:/^--?(?:y|(?:include-?)?symbols?=?(?:true|1)?)$/,excludeLowerChars:/^--?(?:L|(?:exclude|disable|no)-?lower-?(?:case)?|lower-?(?:case)?=(?:false|0))$/,excludeUpperChars:/^--?(?:U|(?:exclude|disable|no)-?upper-?(?:case)?|upper-?(?:case)?=(?:false|0))$/,excludeSimilarChars:/^--?(?:S|(?:exclude|disable|no)-?similar-?(?:char(?:acter)?s?)?|similar-?(?:char(?:acter)?s?)?=(?:false|0))$/,strictMode:/^--?s(?:trict)?(?:-?mode)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/},version:/^[~^>=]?\d+\.\d+\.\d+$/};let c={nc:"[0m",br:"[1;91m",by:"[1;33m",bg:"[1;92m",bw:"[1;97m",blk:"[30m",btBG:"[106m"};app.config={},process.argv.forEach(s=>{var e,p,a;s.startsWith("-")&&(e=Object.keys(app.regex.paramOptions).find(e=>app.regex.paramOptions[e].test(s)),a=Object.keys(app.regex.flags).find(e=>app.regex.flags[e].test(s)),p=Object.keys(app.regex.infoCmds).find(e=>app.regex.infoCmds[e].test(s)),a?app.config[a]=!0:e?(/=.+/.test(s)||(console.error(`
${c.br}${app.msgs.prefix_error}: Arg [--${s.replace(/-/g,"")}] ${app.msgs.error_noEqual}.`+c.nc),l(),process.exit(1)),a=s.split("=")[1],app.config[e]=parseInt(a)||a):p||(console.error(`
${c.br}${app.msgs.prefix_error}: Arg [${s}] ${app.msgs.error_notRecognized}.`+c.nc),console.info(`
${c.by}${app.msgs.info_validArgs}.`+c.nc),g(["paramOptions","flags","infoCmds"]),process.exit(1)))});for(e of["length","qty"])app.config[e]&&(isNaN(app.config[e])||app.config[e]<1)&&(console.error(`
${c.br}${app.msgs.prefix_error}: [${e}] ${app.msgs.error_nonPositiveNum}.`+c.nc),l(),process.exit(1));if(process.argv.some(e=>app.regex.infoCmds.help.test(e)))g();else if(process.argv.some(e=>app.regex.infoCmds.version.test(e))){r=p(`npm view ${JSON.stringify(app.name)} version`).toString().trim()||"none";let e,s=process.cwd();for(;"/"!=s;){var t=i.join(s,"package.json");if(a.existsSync(t)){t=require(t);e=(t.dependencies?.[app.name]||t.devDependencies?.[app.name])?.match(app.regex.version)?.[1]||"none";break}s=i.dirname(s)}console.info(`
${app.msgs.prefix_globalVer}: `+r),console.info(app.msgs.prefix_localVer+": "+e)}else{n=o({length:app.config.length||8,qty:app.config.qty||1,charset:app.config.charset,exclude:app.config.excludeChars,numbers:!!app.config.includeNums,symbols:!!app.config.includeSymbols,lowercase:!app.config.excludeLowerChars,uppercase:!app.config.excludeUpperChars,excludeSimilarChars:!!app.config.excludeSimilarChars,strict:!!app.config.strictMode,verbose:!app.config.quietMode});p=`
${app.msgs.info_copying}...`,app.config.quietMode||console.info(p),s.writeSync([].concat(n).join("\n"))}function l(){console.info(`
${app.msgs.info_moreHelp}, ${app.msgs.info_type} ${app.name} --help' ${app.msgs.info_or} ${app.msgs.info_visit}
`+c.bw+app.urls.docs+c.nc)}function g(e=["header","usage","paramOptions","flags","infoCmds"]){app.prefix=""+c.btBG+c.blk+`[30m ${app.name} ${c.nc} `;let s={header:[`
â”œ ${app.prefix}${app.msgs.appCopyright||`Â© ${app.copyrightYear} ${app.author} under the ${app.license} license`}.`,""+app.prefix+app.msgs.prefix_source+": "+app.urls.src],usage:[`
${c.bw}o ${app.msgs.helpSection_usage}:`+c.nc,` ${c.bw}Â» `+c.bg+app.cmdFormat+c.nc],paramOptions:[`
${c.bw}o ${app.msgs.helpSection_paramOptions}:`+c.nc,` --length=n                  ${app.msgs.optionDesc_length}.`,` --qty=n                     ${app.msgs.optionDesc_qty}.`,` --charset=chars             ${app.msgs.optionDesc_charset}.`,` --exclude=chars             ${app.msgs.optionDesc_exclude}.`],flags:[`
${c.bw}o ${app.msgs.helpSection_flags}:`+c.nc,` -n, --include-numbers       ${app.msgs.optionDesc_includeNums}.`,` -y, --include-symbols       ${app.msgs.optionDesc_includeSymbols}.`,` -L, --no-lowercase          ${app.msgs.optionDesc_noLower}.`,` -U, --no-uppercase          ${app.msgs.optionDesc_noUpper}.`,` -S, --no-similar            ${app.msgs.optionDesc_noSimilar}.`,` -s, --strict                ${app.msgs.optionDesc_strict}.`,` -q, --quiet                 ${app.msgs.optionDesc_quiet}.`],infoCmds:[`
${c.bw}o ${app.msgs.helpSection_infoCmds}:`+c.nc," -h, --help                  "+app.msgs.optionDesc_help,` -v, --version               ${app.msgs.optionDesc_version}.`]};e.forEach(n=>s[n]?.forEach(s=>{{var r=/header|usage/.test(n)?1:29;let p=process.stdout.columns||80,a=[],e=s.match(/\S+|\s+/g),o="";e.forEach(e=>{var s=p-(a.length?r:0);o.length+"| ".length+e.length>s&&(a.push(a.length?o.trimStart():o),o=""),o+=e}),a.push(a.length?o.trimStart():o),a.forEach((e,s)=>console.info("| "+(0==s?e:" ".repeat(r)+e)))}})),console.info(`
${app.msgs.info_moreHelp}, ${app.msgs.info_visit}: `+c.bw+app.urls.docs+c.nc)}})();