#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://github.com/adamlui/scss-to-css/tree/main/node.js/src
 *  Documentation: https://github.com/adamlui/scss-to-css/tree/main/node.js/docs
 */
(()=>{let i="@adamlui/scss-to-css",r="https://github.com/adamlui/scss-to-css/tree/main/node.js/#-command-line-usage",t=require(__dirname.match(/src/)?"./scss-to-css":"./scss-to-css.min"),l=require("fs"),m=require("path"),n=require("node-clipboardy"),o=require("child_process").execSync,p="[1;91m",d="[1;33m",u="[1;92m",f="[1;97m",h={},c={flags:{dryRun:/^--?(?:n|dry-?run)$/,includeDotFolders:/^--?(?:dd?|(?:include-?)?dot-?(?:folder|dir(?:ector(?:y|ie))?)s?=?(?:true|1)?)$/,noSourceMaps:/^--?(?:S|(?:exclude|disable|no)-?so?u?rce?-?maps?|so?u?rce?-?maps?=(?:false|0))$/,noRecursion:/^--?(?:R|(?:disable|no)-?recursi(?:on|ve)|recursi(?:on|ve)=(?:false|0))$/,noMinify:/^--?(?:M|(?:disable|no)-?minif(?:y|ication)|minif(?:y|ication)=(?:false|0))$/,relativeOutput:/^--?(?:r|relative-?output?=?(?:true|1)?)$/,copy:/^--?c(?:opy)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},paramOptions:{ignores:/^--?(?:ignores?|(?:ignore|skip|exclude)(?:d?-?files?)?)(?:=.*|$)/,comment:/^--?comments?(?:=.*|$)/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(s=>{var e,o,i;s.startsWith("-")&&(i=Object.keys(c.flags).find(e=>c.flags[e].test(s)),e=Object.keys(c.paramOptions).find(e=>c.paramOptions[e].test(s)),o=Object.keys(c.infoCmds).find(e=>c.infoCmds[e].test(s)),i?h[i]=!0:e?(/=.+/.test(s)||(console.error(`
${p}ERROR: Arg [--${s.replace(/-/g,"")}] requires '=' followed by a value.[0m`),y(),process.exit(1)),i=s.split("=")[1],h[e]=parseInt(i)||i):o||(console.error(`
${p}ERROR: Arg [${s}] not recognized.[0m`),console.info(`
${d}Valid arguments are below.[0m`),v(["flags","paramOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>c.infoCmds.help.test(e)))v();else if(process.argv.some(e=>c.infoCmds.version.test(e))){var g=o(`npm view ${i} version`).toString().trim()||"none";let e,s=process.cwd();for(;"/"!=s;){var a=m.join(s,"package.json");if(l.existsSync(a)){a=require(a);e=(a.dependencies?.[i]||a.devDependencies?.[i])?.match(/^[~^>=]?\d+\.\d+\.\d+$/)[1]||"none";break}s=m.dirname(s)}console.info(`
Global version: `+g),console.info("Local version: "+e)}else{let[c="",a=""]=process.argv.slice(2).filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),s=m.resolve(process.cwd(),c);c&&!l.existsSync(s)&&(g=s+".scss",l.existsSync(g)?s=g:(console.error(`
${p}Error: First argument can only be an existing file or directory.`+`
'${s}' does not exist.[0m`),console.info(`
${u}Example valid command: 
Â» scss-to-css . output.min.css[0m`),y(),process.exit(1)));var S,g=s.endsWith(".scss")&&!l.statSync(s).isDirectory()?[s]:t.findSCSS(s,{recursive:!h.noRecursion,verbose:!h.quietMode,ignores:(h.ignores?.split(",")??[]).map(e=>e.trim())});if(h.dryRun)g.length?(console.info(`
${d}SCSS files to be compiled:[0m`),g.forEach(e=>console.info(e))):console.info(d+`
No SCSS files will be compiled.[0m`);else{let o=[],e=[];!h.relativeOutput&&l.statSync(s).isDirectory()?(S=t.compile(s,{verbose:!h.quietMode,minify:!h.noMinify,comment:h.comment?.replace(/\\n/g,"\n"),relativeOutput:!1,recursive:!h.noRecursion,dotFolders:!!h.includeDotFolders,sourceMaps:!h.noSourceMaps,ignores:h.ignores?h.ignores.split(",").map(e=>e.trim()):[]}),Array.isArray(S)&&(e=S),S&&(S.error?o.push(s):e=[].concat(S))):e=g.map(e=>{var s=t.compile(e,{verbose:!h.quietMode,minify:!h.noMinify,sourceMaps:!h.noSourceMaps,comment:h.comment?.replace(/\\n/g,"\n")});return s.error&&o.push(e),s}).filter(e=>!e.error),e?.length?(S=1<e.length?"s":"",$(`
${u}Compilation complete![0m`),$(f+e.length+" CSS file"+S+(h.noSourceMaps?"":` + ${e.length} source map`+S)+" generated.[0m")):$(`
${d}No SCSS files processed.[0m`),o.length&&($(`
`+p+o.length+" file"+(1<o.length?"s":"")+" failed to compile:[0m"),o.forEach(e=>$(e))),0==e?.length&&process.exit(0),h.copy&&1==e?.length?(console.log(`
${f}${e[0].code}[0m`),$("\nCopying to clipboard..."),n.writeSync(e[0].code)):($(`
Writing to file${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcMap:s,srcPath:o,relPath:i})=>{let r,t;if(!h.relativeOutput&&i){let e=m.resolve(process.cwd(),a||"css"),s=m.dirname(i);r="."!=s?m.join(e,s):e,t=m.basename(o,".scss")+`${h.noMinify?"":".min"}.css`}else r=m.join(m.dirname(o),a.endsWith(".css")?m.dirname(a):a||"css"),t=(a.endsWith(".css")&&c.endsWith(".scss")?m.basename(a).replace(/(\.min)?\.css$/,""):m.basename(o,".scss"))+".min.css";let n=m.join(r,t);l.existsSync(r)||l.mkdirSync(r,{recursive:!0}),l.writeFileSync(n,e,"utf8"),$(`  ${u}âœ“[0m `+m.relative(process.cwd(),n)),h.noSourceMaps||l.writeFileSync(n+".map",JSON.stringify(s),"utf8"),$(`  ${u}âœ“[0m `+m.relative(process.cwd(),n))}))}}function v(e=["header","usage","pathArgs","flags","paramOptions","infoCmds"]){var s=`[106m[30m ${i.replace(/^@[^/]+\//,"")} [0m `;let o={header:[`
â”œ ${s}Â© 2024â€“2026 Adam Lui & contributors under the MIT license.`,s+"Source: https://github.com/adamlui/scss-to-css/tree/main/node.js/src"],usage:[`
${f}o Usage:[0m`,` ${f}Â» ${u}scss-to-css [inputPath] [outputPath] [options][0m`],pathArgs:[`
${f}o Path arguments:[0m`," [inputPath]                             Path to SCSS file or directory containing SCSS files to be compiled, relative to the current working directory."," [outputPath]                            Path to file or directory where CSS + sourcemap files will be stored, relative to input root (if not provided, css/ is used)."],flags:[`
${f}o Boolean options:[0m`," -n, --dry-run                           Don't actually compile the file(s), just show if they will be processed."," -d, --include-dotfolders                Include dotfolders in file search."," -S, --no-source-maps                    Prevent source maps from being generated."," -M, --no-minify                         Disable minification of output CSS."," -R, --no-recursion                      Disable recursive file searching."," -r, --relative-output                   Output files relative to each source file instead of to input root."," -c, --copy                              Copy compiled CSS to clipboard instead of writing to file if single source file is processed."," -q, --quiet                             Suppress all logging except errors."],paramOptions:[`
${f}o Parameter options:[0m`,'--ignores="dir/,file1.scss,file2.scss"   Files/directories to exclude from compilation.',"--comment=\"comment\"                      Prepend header comment to compiled CSS. Separate by line using '\\n'."],infoCmds:[`
${f}o Info commands:[0m`," -h, --help                              Display help screen."," -v, --version                           Show version number."]};e.forEach(n=>o[n]?.forEach(s=>{{var t=/header|usage/.test(n)?1:41;let o=process.stdout.columns||80,i=[],e=s.match(/\S+|\s+/g),r="";e.forEach(e=>{var s=o-(i.length?t:0);r.length+"| ".length+e.length>s&&(i.push(i.length?r.trimStart():r),r=""),r+=e}),i.push(i.length?r.trimStart():r),i.forEach((e,s)=>console.info("| "+(0==s?e:" ".repeat(t)+e)))}})),console.info(`
For more help, please visit: ${f}${r}[0m`)}function y(){console.info(`
For more help, type 'scss-to-css --help' or visit
${f}${r}[0m`)}function $(e){h.quietMode||console.info(e)}})();