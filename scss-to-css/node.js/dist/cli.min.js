#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.scsstocss.org/node.js
 *  Documentation: https://docs.scsstocss.org/node.js
 */
(()=>{let i="@adamlui/scss-to-css",r="https://docs.scsstocss.org/node.js/#-command-line-usage",n=require(__dirname.match(/src/)?"./scss-to-css":"./scss-to-css.min"),a=require("fs"),m=require("path"),t=require("node-clipboardy"),o=require("child_process").execSync,d="[0m",p="[1;91m",f="[1;33m",u="[1;92m",h="[1;97m",g={},c={flags:{dryRun:/^--?(?:n|dry-?run)$/,includeDotFolders:/^--?(?:dd?|(?:include-?)?dot-?(?:folder|dir(?:ector(?:y|ie))?)s?=?(?:true|1)?)$/,noSourceMaps:/^--?(?:S|(?:exclude|disable|no)-?so?u?rce?-?maps?|so?u?rce?-?maps?=(?:false|0))$/,noRecursion:/^--?(?:R|(?:disable|no)-?recursi(?:on|ve)|recursi(?:on|ve)=(?:false|0))$/,noMinify:/^--?(?:M|(?:disable|no)-?minif(?:y|ication)|minif(?:y|ication)=(?:false|0))$/,cloneFolders:/^--?(?:C|clone-?folders?=?(?:true|1)?)$/,copy:/^--?c(?:opy)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},paramOptions:{ignoreFiles:/^--?(?:ignore|skip|exclude)(?:d?-?files?)?(?:=.*|$)/,comment:/^--?comments?(?:=.*|$)/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(s=>{var e,o,i;s.startsWith("-")&&(i=Object.keys(c.flags).find(e=>c.flags[e].test(s)),e=Object.keys(c.paramOptions).find(e=>c.paramOptions[e].test(s)),o=Object.keys(c.infoCmds).find(e=>c.infoCmds[e].test(s)),i?g[i]=!0:e?(/=.+/.test(s)||(console.error(`
${p}ERROR: Arg [--${s.replace(/-/g,"")}] requires '=' followed by a value.[0m`),$(),process.exit(1)),i=s.split("=")[1],g[e]=parseInt(i)||i):o||(console.error(`
${p}ERROR: Arg [${s}] not recognized.[0m`),console.info(`
${f}Valid arguments are below.[0m`),v(["flags","paramOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>c.infoCmds.help.test(e)))v();else if(process.argv.some(e=>c.infoCmds.version.test(e))){var S=o(`npm view ${i} version`).toString().trim()||"none";let e,s=process.cwd();for(;"/"!=s;){var l=m.join(s,"package.json");if(a.existsSync(l)){l=require(l);e=(l.dependencies?.[i]||l.devDependencies?.[i])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}s=m.dirname(s)}console.info(`
Global version: `+S),console.info("Local version: "+e)}else{let[c="",l=""]=process.argv.slice(2).filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),s=m.resolve(process.cwd(),c);c&&!a.existsSync(s)&&(S=s+".scss",a.existsSync(S)?s=S:(console.error(`
${p}Error: First argument can only be an existing file or directory.`+`
'${s}' does not exist.[0m`),console.info(`
${u}Example valid command: 
Â» scss-to-css . output.min.css[0m`),$(),process.exit(1)));var y,S=s.endsWith(".scss")&&!a.statSync(s).isDirectory()?[s]:n.findSCSS(s,{recursive:!g.noRecursion,verbose:!g.quietMode,ignoreFiles:(g.ignoreFiles?.split(",")??[]).map(e=>e.trim())});if(g.dryRun)S.length?(console.info(`
${f}SCSS files to be compiled:[0m`),S.forEach(e=>console.info(e))):console.info(f+`
No SCSS files will be compiled.[0m`);else{let o=[],e=[];g.cloneFolders&&a.statSync(s).isDirectory()?(y=n.compile(s,{verbose:!g.quietMode,minify:!g.noMinify,comment:g.comment?.replace(/\\n/g,"\n"),cloneFolders:!0,recursive:!g.noRecursion,dotFolders:!!g.includeDotFolders,sourceMaps:!g.noSourceMaps,ignoreFiles:g.ignoreFiles?g.ignoreFiles.split(",").map(e=>e.trim()):[]}),Array.isArray(y)?e=y:y&&y.error?o.push(s):y&&(e=[y])):e=S.map(e=>{var s=n.compile(e,{verbose:!g.quietMode,minify:!g.noMinify,sourceMaps:!g.noSourceMaps,comment:g.comment?.replace(/\\n/g,"\n")});return s.error&&o.push(e),s}).filter(e=>!e.error),e?.length?(y=1<e.length?"s":"",b(`
${u}Compilation complete![0m`),b(h+e.length+" CSS file"+y+(g.noSourceMaps?"":` + ${e.length} source map`+y)+" generated."+d)):b(`
${f}No SCSS files processed.[0m`),o.length&&(b(`
`+p+o.length+" file"+(1<o.length?"s":"")+" failed to compile:[0m"),o.forEach(e=>b(e))),0==e?.length&&process.exit(0),g.copy&&1==e?.length?(console.log(`
`+h+e[0].code+d),b("\nCopying to clipboard..."),t.writeSync(e[0].code)):(b(`
Writing to file${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcMap:s,srcPath:o,relPath:i})=>{let r,n;if(g.cloneFolders&&i&&l){let e=m.resolve(process.cwd(),l),s=m.dirname(i);r="."!=s?m.join(e,s):e,n=m.basename(o,".scss")+`${g.noMinify?"":".min"}.css`}else r=m.join(m.dirname(o),/(?:src|s[ac]ss)$/.test(m.dirname(o))?"../"+(l||"css"):l.endsWith(".css")?m.dirname(l):l||"css"),n=(l.endsWith(".css")&&c.endsWith(".scss")?m.basename(l).replace(/(\.min)?\.css$/,""):m.basename(o,".scss"))+".min.css";let t=m.join(r,n);a.existsSync(r)||a.mkdirSync(r,{recursive:!0}),a.writeFileSync(t,e,"utf8"),b(`  ${u}âœ“[0m `+m.relative(process.cwd(),t)),g.noSourceMaps||a.writeFileSync(t+".map",JSON.stringify(s),"utf8"),b(`  ${u}âœ“[0m `+m.relative(process.cwd(),t))}))}}function v(e=["header","usage","pathArgs","flags","paramOptions","infoCmds"]){var s=`[106m[30m ${i.replace(/^@[^/]+\//,"")} [0m `;let o={header:[`
â”œ `+s+"Â© 2024â€“2026 Adam Lui & contributors under the MIT license.",s+"Source: https://code.scsstocss.org/node.js"],usage:[`
${h}o Usage:[0m`,` ${h}Â» `+u+"scss-to-css [inputPath] [outputPath] [options]"+d],pathArgs:[`
${h}o Path arguments:[0m`," [inputPath]                             Path to SCSS file or directory containing SCSS files to be compiled, relative to the current working directory."," [outputPath]                            Path to file or directory where CSS + sourcemap files will be stored, relative to input root (if not provided, css/ is used)."],flags:[`
${h}o Boolean options:[0m`," -n, --dry-run                           Don't actually compile the file(s), just show if they will be processed."," -d, --include-dotfolders                Include dotfolders in file search."," -S, --no-source-maps                    Prevent source maps from being generated."," -M, --no-minify                         Disable minification of output CSS."," -R, --no-recursion                      Disable recursive file searching."," -r, --relative-output                     Output files relative to each source file instead of to input root."," -c, --copy                              Copy compiled CSS to clipboard instead of writing to file if single source file is processed."," -q, --quiet                             Suppress all logging except errors."],paramOptions:[`
${h}o Parameter options:[0m`,'--ignore-files="file1.scss,file2.scss"   Files to exclude from compilation.',"--comment=\"comment\"                      Prepend header comment to compiled CSS. Separate by line using '\\n'."],infoCmds:[`
${h}o Info commands:[0m`," -h, --help                              Display help screen."," -v, --version                           Show version number."]};e.forEach(t=>o[t]?.forEach(s=>{{var n=/header|usage/.test(t)?1:41;let o=process.stdout.columns||80,i=[],e=s.match(/\S+|\s+/g),r="";e.forEach(e=>{var s=o-(i.length?n:0);r.length+"| ".length+e.length>s&&(i.push(i.length?r.trimStart():r),r=""),r+=e}),i.push(i.length?r.trimStart():r),i.forEach((e,s)=>console.info("| "+(0==s?e:" ".repeat(n)+e)))}})),console.info("\nFor more help, please visit: "+h+r+d)}function $(){console.info(`
For more help, type 'scss-to-css --help' or visit
`+h+r+d)}function b(e){g.quietMode||console.info(e)}})();