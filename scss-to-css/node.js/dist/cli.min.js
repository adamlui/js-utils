#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.scsstocss.org/node.js
 *  Documentation: https://docs.scsstocss.org/node.js
 */
(()=>{let i="@adamlui/scss-to-css",r="https://docs.scsstocss.org/node.js/#-command-line-usage",t=require(__dirname.match(/src/)?"./scss-to-css":"./scss-to-css.min"),c=require("fs"),l=require("path"),s=require("node-clipboardy"),o=require("child_process").execSync,a="[0m",m="[1;91m",p="[1;33m",d="[1;92m",f="[1;97m",u={},n={flags:{dryRun:/^--?(?:n|dry-?run)$/,includeDotFolders:/^--?(?:dd?|(?:include-?)?dot-?(?:folder|dir(?:ector(?:y|ie))?)s?=?(?:true|1)?)$/,noSourceMaps:/^--?(?:S|(?:exclude|disable|no)-?so?u?rce?-?maps?|so?u?rce?-?maps?=(?:false|0))$/,noRecursion:/^--?(?:R|(?:disable|no)-?recursi(?:on|ve)|recursi(?:on|ve)=(?:false|0))$/,noMinify:/^--?(?:M|(?:disable|no)-?minif(?:y|ication)|minif(?:y|ication)=(?:false|0))$/,copy:/^--?c(?:opy)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},paramOptions:{ignoreFiles:/^--?(?:ignore|skip|exclude)(?:d?-?files?)?(?:=.*|$)/,comment:/^--?comments?(?:=.*|$)/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(s=>{var e,o,i;s.startsWith("-")&&(i=Object.keys(n.flags).find(e=>n.flags[e].test(s)),e=Object.keys(n.paramOptions).find(e=>n.paramOptions[e].test(s)),o=Object.keys(n.infoCmds).find(e=>n.infoCmds[e].test(s)),i?u[i]=!0:e?(/=.+/.test(s)||(console.error(`
${m}ERROR: Arg [--${s.replace(/-/g,"")}] requires '=' followed by a value.[0m`),v(),process.exit(1)),i=s.split("=")[1],u[e]=parseInt(i)||i):o||(console.error(`
${m}ERROR: Arg [${s}] not recognized.[0m`),console.info(`
${p}Valid arguments are below.[0m`),y(["flags","paramOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>n.infoCmds.help.test(e)))y();else if(process.argv.some(e=>n.infoCmds.version.test(e))){var h=o(`npm view ${i} version`).toString().trim()||"none";let e,s=process.cwd();for(;"/"!=s;){var g=l.join(s,"package.json");if(c.existsSync(g)){g=require(g);e=(g.dependencies?.[i]||g.devDependencies?.[i])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}s=l.dirname(s)}console.info(`
Global version: `+h),console.info("Local version: "+e)}else{let[r="",n=""]=process.argv.slice(2).filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),e=l.resolve(process.cwd(),r);r&&!c.existsSync(e)&&(h=e+".scss",c.existsSync(h)?e=h:(console.error(`
${m}Error: First argument can only be an existing file or directory.`+`
'${e}' does not exist.[0m`),console.info(`
${d}Example valid command: 
Â» scss-to-css . output.min.css[0m`),v(),process.exit(1)));h=e.endsWith(".scss")&&!c.statSync(e).isDirectory()?[e]:t.findSCSS(e,{recursive:!u.noRecursion,verbose:!u.quietMode,ignoreFiles:(u.ignoreFiles?.split(",")??[]).map(e=>e.trim())});if(u.dryRun)h.length?(console.info(`
${p}SCSS files to be compiled:[0m`),h.forEach(e=>console.info(e))):console.info(p+`
No SCSS files will be compiled.[0m`);else{let o=[];var S,h=h.map(e=>{var s=t.compile(e,{verbose:!u.quietMode,minify:!u.noMinify,sourceMaps:!u.noSourceMaps,comment:u.comment?.replace(/\\n/g,"\n")});return s.error&&o.push(e),s}).filter(e=>!e.error);h?.length?(S=1<h.length?"s":"",$(`
${d}Compilation complete![0m`),$(f+h.length+" CSS file"+S+(u.noSourceMaps?"":` + ${h.length} source map`+S)+" generated."+a)):$(`
${p}No SCSS files processed.[0m`),o.length&&($(`
`+m+o.length+" file"+(1<o.length?"s":"")+" failed to compile:[0m"),o.forEach(e=>$(e))),0==h?.length&&process.exit(0),u.copy&&1==h?.length?(console.log(`
`+f+h[0].code+a),$("\nCopying to clipboard..."),s.writeSync(h[0].code)):($(`
Writing to file${1<h?.length?"s":""}...`),h?.forEach(({code:e,srcMap:s,srcPath:o})=>{var i=l.join(l.dirname(o),/(?:src|s[ac]ss)$/.test(l.dirname(o))?"../"+(n||"css"):n.endsWith(".css")?l.dirname(n):n||"css"),o=(n.endsWith(".css")&&r.endsWith(".scss")?l.basename(n).replace(/(\.min)?\.css$/,""):l.basename(o,".scss"))+".min.css",o=l.join(i,o);c.existsSync(i)||c.mkdirSync(i,{recursive:!0}),c.writeFileSync(o,e,"utf8"),u.noSourceMaps||c.writeFileSync(o+".map",JSON.stringify(s),"utf8")}))}}function y(e=["header","usage","pathArgs","flags","paramOptions","infoCmds"]){var s=`[106m[30m ${i.replace(/^@[^/]+\//,"")} [0m `;let o={header:[`
â”œ `+s+"Â© 2024â€“2025 Adam Lui & contributors under the MIT license.",s+"Source: https://code.scsstocss.org/node.js"],usage:[`
${f}o Usage:[0m`,` ${f}Â» `+d+"scss-to-css [inputPath] [outputPath] [options]"+a],pathArgs:[`
${f}o Path arguments:[0m`," [inputPath]                             Path to SCSS file or directory containing SCSS files to be compiled, relative to the current working directory."," [outputPath]                            Path to file or directory where CSS + sourcemap files will be stored, relative to original file location (if not provided, css/ is used)."],flags:[`
${f}o Boolean options:[0m`," -n, --dry-run                           Don't actually compile the file(s), just show if they will be processed."," -d, --include-dotfolders                Include dotfolders in file search."," -S, --no-source-maps                    Prevent source maps from being generated."," -M, --no-minify                         Disable minification of output CSS."," -R, --no-recursion                      Disable recursive file searching."," -c, --copy                              Copy compiled CSS to clipboard instead of writing to file if single source file is processed."," -q, --quiet                             Suppress all logging except errors."],paramOptions:[`
${f}o Parameter options:[0m`,'--ignore-files="file1.scss,file2.scss"   Files to exclude from compilation.',"--comment=\"comment\"                      Prepend header comment to compiled CSS. Separate by line using '\\n'."],infoCmds:[`
${f}o Info commands:[0m`," -h, --help                              Display help screen."," -v, --version                           Show version number."]};e.forEach(t=>o[t]?.forEach(s=>{{var n=/header|usage/.test(t)?1:41;let o=process.stdout.columns||80,i=[],e=s.match(/\S+|\s+/g),r="";e.forEach(e=>{var s=o-(i.length?n:0);r.length+"| ".length+e.length>s&&(i.push(i.length?r.trimStart():r),r=""),r+=e}),i.push(i.length?r.trimStart():r),i.forEach((e,s)=>console.info("| "+(0==s?e:" ".repeat(n)+e)))}})),console.info("\nFor more help, please visit: "+f+r+a)}function v(){console.info(`
For more help, type 'scss-to-css --help' or visit
`+f+r+a)}function $(e){u.quietMode||console.info(e)}})();