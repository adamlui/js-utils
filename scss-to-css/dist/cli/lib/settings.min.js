/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/scss-to-css/tree/main/src
 * Documentation: https://github.com/adamlui/scss-to-css/tree/main/docs
 */
let fs=require("fs"),log=require(`./log${env.devMode?"":".min"}.js`),path=require("path");(globalThis.app??={}).config={},module.exports={configFilename:"scss-to-css.config.mjs",controls:{dryRun:{type:"flag",regex:/^--?(?:n|dry-?run)$/},includeDotFolders:{type:"flag",regex:/^--?(?:dd?|(?:include-?)?dot-?(?:folder|dir(?:ector(?:y|ie))?)s?=?(?:true|1)?)$/},noSourceMaps:{type:"flag",regex:/^--?(?:S|(?:exclude|disable|no)-?so?u?rce?-?maps?|so?u?rce?-?maps?=(?:false|0))$/},noRecursion:{type:"flag",regex:/^--?(?:R|(?:disable|no)-?recursi(?:on|ve)|recursi(?:on|ve)=(?:false|0))$/},noMinify:{type:"flag",regex:/^--?(?:M|(?:disable|no)-?minif(?:y|ication)|minif(?:y|ication)=(?:false|0))$/},relativeOutput:{type:"param",regex:/^--?(?:r|relative-?output?=?(?:true|1)?)$/},copy:{type:"param",regex:/^--?c(?:opy)?$/},quietMode:{type:"param",regex:/^--?q(?:uiet)?(?:-?mode)?$/},ignores:{type:"param",regex:/^--?(?:ignores?|(?:ignore|skip|exclude)(?:d?-?files?)?)(?:=.*|$)/},comment:{type:"param",regex:/^--?comments?(?:=.*|$)/},config:{type:"param",regex:/^--?config(?:=.*|$)/},init:{type:"cmd",regex:/^-{0,2}i(?:nit)?$/},help:{type:"cmd",regex:/^--?h(?:elp)?$/},version:{type:"cmd",regex:/^--?ve?r?s?i?o?n?$/}},async initConfigFile(e=this.configFilename){var r=path.resolve(process.cwd(),e);if(fs.existsSync(r))return log.warn(app.msgs.warn_configFileExists+":",r);var i=path.resolve(__dirname,"../../"+(env.devMode?"../":"./data/")+e);if(fs.existsSync(i))fs.copyFileSync(i,r);else{i=app.urls.jsdelivr+"/"+e;log.data(app.msgs.info_fetchingRemoteConfigFrom+` ${i}...`);try{var o=await require(`./data${env.devMode?"":".min"}.js`).fetch(i);if(!o.ok)return log.warn(`${app.msgs.warn_remoteConfigNotFound}: ${i} (${o.status})`);require(`./data${env.devMode?"":".min"}.js`).atomicWrite(r,await o.text())}catch(e){return log.warn(app.msgs.warn_remoteConfigFailed+`: ${i} `+e.message)}}log.success(app.msgs.info_configFileCreated+`: ${r}
`),log.tip(app.msgs.tip_editToSetDefaults+"."),log.tip(app.msgs.tip_cliArgsPrioritized+".")},load({args:e=process.argv.slice(2),ctrlKeys:s=Object.keys(this.controls)}={}){let r=null;var i=e.find(e=>this.controls.config.regex.test(e));if(i){/=/.test(i)||log.errorAndExit(`[${i}] `+app.msgs.error_mustIncludePath);i=i.split("=")[1];r=path.isAbsolute(i)?i:path.resolve(process.cwd(),i),fs.existsSync(r)||log.configURLandExit(app.msgs.error_configFileNotFound+":",r)}else for(var o of["mjs","cjs","js"]){o=path.resolve(process.cwd(),this.configFilename.replace(/\.[^.]+$/,"."+o));if(fs.existsSync(o)){r=o;break}}if(r)try{var t=require(r),a=t?.default??t;a&&"object"==typeof a||log.configURLandExit(app.msgs.error_invalidConfigFile+"."),Object.assign(app.config,a)}catch(e){log.configURLandExit(app.msgs.error_failedToLoadConfigFile+":",r,`
`+e.message)}return e.forEach(r=>{if(!/^[^-]|--?(?:config|debug)/.test(r)){var i=s.find(e=>this.controls[e]?.regex?.test(r)),o=(i||log.errorAndExit(`[${r}] ${app.msgs.error_notRecognized}.`),this.controls[i]);if("cmd"!=o.type){let e="param"!=o.type||r.split("=")[1]?.trim();o.mode?app.config.mode=i.replace(/mode$/i,"").toLowerCase():((o=o.parser)&&(e=o(e),isNaN(e)||e<1)&&log.errorAndExit(`[${i}] ${app.msgs.error_nonPositiveNum}.`),app.config[i]=e)}}}),app.config}};