#!/usr/bin/env node
/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/scss-to-css/tree/main/src
 * Documentation: https://github.com/adamlui/scss-to-css/tree/main/docs
 */
(async()=>{var e,s=process.argv.slice(2);globalThis.env={debugMode:s.some(e=>/^--?debug(?:-?mode)?$/.test(e)),devMode:/[\\/]src(?:[\\/]|$)/i.test(__dirname)};let o=require("node-clipboardy"),c=require("fs"),{generateRandomLang:i,getMsgs:n,getSysLang:r}=require(`./lib/language${env.devMode?"":".min"}.js`),t=require(`./lib/log${env.devMode?"":".min"}.js`),a=require("path"),p=require(`../scss-to-css${env.devMode?"":".min"}.js`),g=require(`./lib/settings${env.devMode?"":".min"}.js`);Object.assign(globalThis.app??={},require(`../${env.devMode?"../":"./data/"}app.json`)),t.debug(app.msgs=await n(env.debugMode?i({excludes:["en"]}):r())),app.urls.docs+="/#-command-line-usage";for(e of s){if(g.controls.init.regex.test(e))return g.initConfigFile();if(g.controls.help.regex.test(e))return t.help();if(g.controls.version.regex.test(e))return t.version()}let[l="",f=""]=s.filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),d=a.resolve(process.cwd(),l);l&&!c.existsSync(d)&&(s=d+".scss",c.existsSync(s)?d=s:(t.error(`${app.msgs.error_firstArgNotExist}.\n${d} ${app.msgs.error_doesNotExist}.`),t.success(app.msgs.info_exampleValidCmd+`: 
» scss-to-css . output.min.css`),t.helpCmdAndDocURL(),process.exit(1))),g.load();var m,s=d.endsWith(".scss")&&!c.statSync(d).isDirectory()?[d]:p.findSCSS(d,{recursive:!app.config.noRecursion,verbose:!app.config.quietMode,ignores:(app.config.ignores?.split(",")??[]).map(e=>e.trim())});if(app.config.dryRun)s.length?(t.info(app.msgs.info_scssFilesToBeCompiled+":"),s.forEach(e=>console.info(e))):t.info(`
${app.msgs.info_noSCSSfilesWillBeCompiled}.`);else{let i=[],e=[];!app.config.relativeOutput&&c.statSync(d).isDirectory()?(m=p.compile(d,{verbose:!app.config.quietMode,minify:!app.config.noMinify,comment:app.config.comment?.replace(/\\n/g,"\n"),relativeOutput:!1,recursive:!app.config.noRecursion,dotFolders:!!app.config.includeDotFolders,sourceMaps:!app.config.noSourceMaps,ignores:app.config.ignores?app.config.ignores.split(",").map(e=>e.trim()):[]}),Array.isArray(m)&&(e=m),m&&(m.error?i.push(d):e=[].concat(m))):e=s.map(e=>{var s=p.compile(e,{verbose:!app.config.quietMode,minify:!app.config.noMinify,sourceMaps:!app.config.noSourceMaps,comment:app.config.comment?.replace(/\\n/g,"\n")});return s.error&&i.push(e),s}).filter(e=>!e.error),app.config.quietMode||(s=1==(m=e.length)?"":"s",m?(t.success(app.msgs.info_compilationComplete+"!"),t.data(`${m} CSS ${app.msgs.info_file}${s}${app.config.noSourceMaps?"":` + ${m} `+app.msgs.info_srcMap+s} ${app.msgs.info_generated}.`)):console.info(app.msgs.info_noSCSSfilesProcessed+"."),i.length&&(t.error(i.length+" "+app.msgs.info_file+(1==i.length?"":"s"),app.msgs.info_failedToCompile+":"),i.forEach(e=>t.ifNotQuiet(e)))),e?.length&&(app.config.copy&&1==e?.length?(t.data(e[0].code),t.ifNotQuiet(`
${app.msgs.info_copying}...`),o.writeSync(e[0].code)):(t.ifNotQuiet(`
${app.msgs.info_writing}${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcMap:s,srcPath:i,relPath:o})=>{let n,r;if(!app.config.relativeOutput&&o){let e=a.resolve(process.cwd(),f||"css"),s=a.dirname(o);n="."!=s?a.join(e,s):e,r=`${a.basename(i,".scss")}${app.config.noMinify?"":".min"}.css`}else n=a.join(a.dirname(i),f.endsWith(".css")?a.dirname(f):f||"css"),r=`${f.endsWith(".css")&&l.endsWith(".scss")?a.basename(f).replace(/(\.min)?\.css$/,""):a.basename(i,".scss")}.min.css`;let p=a.join(n,r);c.mkdirSync(n,{recursive:!0}),c.writeFileSync(p,e,"utf8"),t.ifNotQuiet(`  ${t.colors.bg}✓${t.colors.nc} `+a.relative(process.cwd(),p)),app.config.noSourceMaps||c.writeFileSync(p+".map",JSON.stringify(s),"utf8"),t.ifNotQuiet(`  ${t.colors.bg}✓${t.colors.nc} ${a.relative(process.cwd(),p)}.map`)})))}})();