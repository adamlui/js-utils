#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.js-utils.com/generate-ip
 *  Documentation: https://docs.js-utils.com/generate-ip
 */
const pkgName="generate-ip",copyright="Â© 2024 Adam Lui & contributors under the MIT license.",cmdFormat="generate-ip [options|commands]",srcURL="https://code.js-utils.com/generate-ip",docURL="https://docs.js-utils.com/generate-ip/#-command-line-usage";(async()=>{const e=require(__dirname.match(/src/)?"./generate-ip":"./generate-ip.min")["ipv4"],r=require("fs"),s=require("path"),n=require("child_process")["execSync"],t="[0m",a="[1;91m",i="[1;97m";let l;l="win32"==process.platform?n("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim():((c=process.env).LANG||c.LANGUAGE||c.LC_ALL||c.LC_MESSAGES||c.LC_NAME)?.split(".")[0];var o,c=new Promise((t,a)=>{const i="https://raw.githubusercontent.com/adamlui/js-utils/main/generate-ip/_locales/",e=(l?l.replace("-","_"):"en")+"/";let c=i+e+"messages.json",p=0;f(c).then(async function o(e){try{const r=await e.json(),s={};for(const n in r)"object"==typeof r[n]&&null!==r[n]&&"message"in r[n]&&(s[n]=r[n].message);t(s)}catch(e){3!=++p&&f(c=l.includes("-")&&1===p?c.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):i+"en/messages.json").then(o).catch(a)}}).catch(a)});let p={};try{p=await c}catch(e){}const m={},g={paramOptions:{qty:/^--?qu?a?n?ti?t?y(?:=.*|$)/},flags:{quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(o=>{var e,r,s;o.startsWith("-")&&(e=Object.keys(g.paramOptions).find(e=>g.paramOptions[e].test(o)),s=Object.keys(g.flags).find(e=>g.flags[e].test(o)),r=Object.keys(g.infoCmds).find(e=>g.infoCmds[e].test(o)),s?m[s]=!0:e?(o.includes("=")||(console.error(`
${a+(p.prefix_error||"ERROR")}: `+`Arg [--${o.replace(/-/g,"")}] `+`${p.error_noEqual||"requires '=' followed by a value"}.${t}`),u(),process.exit(1)),s=o.split("=")[1],m[e]=parseInt(s)||s):r||(console.error(`
${a+(p.prefix_error||"ERROR")}: `+`Arg [${o}] ${p.error_notRecognized||"not recognized"}.[0m`),console.info(`
[1;33mValid arguments are below.[0m`),h(["paramOptions","flags","infoCmds"]),process.exit(1)))}),process.argv.some(e=>g.infoCmds.help.test(e)))h();else if(process.argv.some(e=>g.infoCmds.version.test(e))){c=n(`npm view ${pkgName} version`).toString().trim()||"none";let e,o=process.cwd();for(;"/"!=o;){var d=s.join(o,"package.json");if(r.existsSync(d)){d=require(d);e=(d.dependencies?.[pkgName]||d.devDependencies?.[pkgName])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}o=s.dirname(o)}console.info(`
${p.prefix_globalVer||"Global version"}: `+c),console.info(`${p.prefix_localVer||"Local version"}: `+e)}else{m.qty&&(isNaN(m.qty)||m.qty<1)&&(console.error(`
${a}Error: [qty] argument can only be > 0.[0m`),u(),process.exit(1));c=e.generate({qty:m.qty||1,verbose:!m.quietMode});m.quietMode||(1<m.qty&&console.info(`[ ${c.join(", ")} ]`),console.info("\nCopying to clipboard...")),o=(o=Array.isArray(c)?c.join("\n"):c).replace(/\s+$/,"").replace(/"/g,'""'),"darwin"==process.platform?n(`printf "${o}" | pbcopy`):"linux"==process.platform?n(`printf "${o}" | xclip -selection clipboard`):"win32"==process.platform&&n(`Set-Clipboard -Value "${o}"`,{shell:"powershell"})}function f(s){return new Promise((r,e)=>{var o=s.match(/^([^:]+):\/\//)[1];/^https?$/.test(o)||e(new Error("Invalid URL.")),require(o).get(s,e=>{let o="";e.on("data",e=>o+=e),e.on("end",()=>r({json:()=>JSON.parse(o)}))}).on("error",e)})}function h(e=["header","usage","paramOptions","flags","infoCmds"]){var o=`[106m[30m ${pkgName} [0m `;const r={header:["\nâ”œ "+o+(p.appCopyright||copyright),o+(p.prefix_source||"Source")+": "+srcURL],usage:[`
${i}o Usage:[0m`," [1;97mÂ» [1;92m"+cmdFormat+t],paramOptions:[`
${i}o ${i}Parameter options:[0m`," --qty=n                     Generate n IP address(es)."],flags:[`
${i}o ${i}Boolean options:[0m`," -q, --quiet                 Suppress all logging except errors."],infoCmds:[`
${i}o ${i}Info commands:[0m`," -h, --help                  Display help screen."," -v, --version               Show version number."]};e.forEach(a=>{r[a]?.forEach(e=>{{var s=/header|usage/.test(a)?1:29;const n=process.stdout.columns||80,t=[],o=e.match(/\S+|\s+/g);let r="";o.forEach(e=>{var o=n-(0==t.length?0:s);r.length+"| ".length+e.length>o&&(t.push(0==t.length?r:r.trimStart()),r=""),r+=e}),t.push(0==t.length?r:r.trimStart()),t.forEach((e,o)=>console.info("| "+(0==o?e:" ".repeat(s)+e)))}})}),console.info("\nFor more help, please visit: "+i+docURL+t)}function u(){console.info(`
For more help, type 'generate-ip --help' or visit
`+i+docURL+t)}})();