#!/usr/bin/env node
/**
 *  Â© 2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.generate-ip.org
 *  Documentation: https://docs.generate-ip.org
 */
const pkgName="generate-ip",copyright="Â© 2024 Adam Lui & contributors under the MIT license.",cmdFormat="generate-[ip|ipv6|mac] [options|commands]",srcURL="https://code.generate-ip.org",docURL="https://docs.generate-ip.org/#-command-line-usage";(async()=>{const{ipv4:e,ipv6:o,mac:r}=require(__dirname.match(/src/)?"./generate-ip":"./generate-ip.min"),s=require("fs"),n=require("path"),t=require("child_process")["execSync"],i="[0m",a="[1;91m",p="[1;97m";let l="en";if("win32"==process.platform)try{l=t("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){}else{var c=process.env;l=(c.LANG||c.LANGUAGE||c.LC_ALL||c.LC_MESSAGES||c.LC_NAME||"en").split(".")[0]}let m={};var d,c=new Promise((t,i)=>{const a="https://cdn.jsdelivr.net/gh/adamlui/js-utils@79f4e9a62f78053b47cd4ef55e984b2926ab941d/generate-ip/_locales/",e=(l?l.replace("-","_"):"en")+"/";let p=a+e+"messages.json",c=0;u(p).then(async function o(e){try{const r=await e.json(),s={};for(const n in r)"object"==typeof r[n]&&"message"in r[n]&&(s[n]=r[n].message);t(s)}catch(e){if(3==++c)return t({});u(p=l.includes("-")&&1==c?p.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):a+"en/messages.json").then(o).catch(i)}}).catch(i)});try{m=await c}catch(e){}const f={},g={paramOptions:{qty:/^--?qu?a?n?ti?t?y(?:=.*|$)/},flags:{ipv6mode:/^--?(?:ip)?v?6(?:-?mode)?$/,macMode:/^--?m(?:ac)?(?:-?mode)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(o=>{var e,r,s;o.startsWith("-")&&(e=Object.keys(g.paramOptions).find(e=>g.paramOptions[e].test(o)),s=Object.keys(g.flags).find(e=>g.flags[e].test(o)),r=Object.keys(g.infoCmds).find(e=>g.infoCmds[e].test(o)),s?f[s]=!0:e?(/=.+/.test(o)||(console.error(`
${a+(m.prefix_error||"ERROR")}: `+`Arg [--${o.replace(/-/g,"")}] `+`${m.error_noEqual||"requires '=' followed by a value"}.${i}`),v(),process.exit(1)),s=o.split("=")[1],f[e]=parseInt(s)||s):r||/ipv4/.test(o)||(console.error(`
${a+(m.prefix_error||"ERROR")}: `+`Arg [${o}] ${m.error_notRecognized||"not recognized"}.[0m`),console.info(`
${"[1;33m"+(m.info_validArgs||"Valid arguments are below")}.[0m`),$(["paramOptions","flags","infoCmds"]),process.exit(1)))}),f.qty&&(isNaN(f.qty)||f.qty<1)&&(console.error(`
${a+(m.prefix_error||"ERROR")}: [qty] `+`${m.error_nonPositiveNum||"argument can only be > 0"}.${i}`),v(),process.exit(1)),process.argv.some(e=>g.infoCmds.help.test(e)))$();else if(process.argv.some(e=>g.infoCmds.version.test(e))){c=t(`npm view ${pkgName} version`).toString().trim()||"none";let e,o=process.cwd();for(;"/"!=o;){var h=n.join(o,"package.json");if(s.existsSync(h)){h=require(h);e=(h.dependencies?.[pkgName]||h.devDependencies?.[pkgName])?.match(/(\d+\.\d+\.\d+)/)[0]||"none";break}o=n.dirname(o)}console.info(`
${m.prefix_globalVer||"Global version"}: `+c),console.info(`${m.prefix_localVer||"Local version"}: `+e)}else{c={qty:f.qty||1,verbose:!f.quietMode},c=(f.ipv6mode?o:f.macMode?r:e).generate(c);d=`
${m.info_copying||"Copying to clipboard"}...`,f.quietMode||console.info(d),d=Array.isArray(c)?c.join("\n"):c,"darwin"==process.platform?t(`printf "${d}" | pbcopy`):"linux"==process.platform?t(`printf "${d}" | xclip -selection clipboard`):"win32"==process.platform&&t(`Set-Clipboard -Value "${d}"`,{shell:"powershell"})}function u(s){return new Promise((r,e)=>{var o=s.match(/^([^:]+):\/\//)[1];/^https?$/.test(o)||e(new Error(`${m.error_invalidURL||"Invalid URL"}.`)),require(o).get(s,e=>{let o="";e.on("data",e=>o+=e),e.on("end",()=>r({json:()=>JSON.parse(o)}))}).on("error",e)})}function $(e=["header","usage","paramOptions","flags","infoCmds"]){var o=`[106m[30m ${pkgName} [0m `;const r={header:["\nâ”œ "+o+(m.appCopyright||copyright),o+(m.prefix_source||"Source")+": "+srcURL],usage:[`
${p}o ${m.helpSection_usage||"Usage"}:[0m`," [1;97mÂ» [1;92m"+cmdFormat+i],paramOptions:[`
${p}o ${m.helpSection_paramOptions||"Parameter options"}:[0m`,` --qty=n                     ${m.optionDesc_qty||"Generate n IP address(es)"}.`],flags:[`
${p}o ${m.helpSection_flags||"Boolean options"}:[0m`,` -6, --ipv6                  ${m.optionDesc_ipv6||"Generate IPv6 address"}.`,` -m, --mac                   ${m.optionDesc_mac||"Generate MAC address"}.`,` -q, --quiet                 ${m.optionDesc_quiet||"Suppress all logging except errors"}.`],infoCmds:[`
${p}o ${m.helpSection_infoCmds||"Info commands"}:[0m`," -h, --help                  "+(m.optionDesc_help||"Display help screen."),` -v, --version               ${m.optionDesc_version||"Show version number"}.`]};e.forEach(i=>{r[i]?.forEach(e=>{{var s=/header|usage/.test(i)?1:29;const n=process.stdout.columns||80,t=[],o=e.match(/\S+|\s+/g);let r="";o.forEach(e=>{var o=n-(0==t.length?0:s);r.length+"| ".length+e.length>o&&(t.push(0==t.length?r:r.trimStart()),r=""),r+=e}),t.push(0==t.length?r:r.trimStart()),t.forEach((e,o)=>console.info("| "+(0==o?e:" ".repeat(s)+e)))}})}),console.info(`
${m.info_moreHelp||"For more help"}, ${m.info_visit||"visit"}: `+p+docURL+i)}function v(){console.info(`
${m.info_moreHelp||"For more help"},`+` ${m.info_type||"type"} 'generate-ip --help'`+` ${m.info_or||"or"} ${m.info_visit||"visit"}
`+p+docURL+i)}})();