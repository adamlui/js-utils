#!/usr/bin/env node
const n=require("crypto")["randomInt"],s=require("child_process")["execSync"],t={generate:function(e={}){(e={verbose:!0,...e}).verbose&&console.info("ipv4.generate() Â» Generating IPv4 address...");var o=[];for(let e=0;e<4;e++)o.push(n(0,256));var r=o.join(".");return e.verbose&&console.log("\n"+r),r},validate:function(e,o={}){(o={verbose:!0,...o}).verbose&&console.info("ipv4.validate() Â» "+`Validating ${e}...`);e=e.split("."),e=!(4!==e.length||e.some(e=>!/^\d+$/.test(e)||parseInt(e,10)<0||255<parseInt(e,10)));return o.verbose&&console.info("ipv4.validate() Â» "+`IP is ${e?"":"in"}valid IPv4 address!`),e}},e={generate:function(e={}){(e={verbose:!0,leadingZeros:!1,doubleColon:!0,...e}).verbose&&console.info("ipv6.generate() Â» Generating IPv6 address...");var r=[];for(let e=0;e<8;e++){let o="";for(let e=0;e<4;e++)o+=n(0,16).toString(16);r.push(o)}var o=this.format(r.join(":"),{...e,verbose:!1});return e.verbose&&console.log("\n"+o),o},format:function(e,o={}){var r,n;if(o={verbose:!0,leadingZeros:!1,doubleColon:!0,...o},!this.validate(e,{verbose:!1}))return console.error("ipv6.format() Â» "+`ERROR: 
- ${e} is not a valid IPv6 address.`);o.verbose&&console.info(`ipv6.format() Â» Formatting ${e}...`);let s=e;if(s=o.doubleColon?(o.verbose&&console.info("ipv6.format() Â» Replacing zero series w/ '::'..."),s.replace(/:(?:0+:)+/,"::")):(o.verbose&&console.info("ipv6.format() Â» Expanding '::' into zero series..."),n=s.split(":").filter(Boolean).length,r=o.leadingZeros?"0000":"0",n=Array(8-n).fill(r).join(":"),s.replace("::",`:${n}:`)),o.leadingZeros){o.verbose&&console.info("ipv6.format() Â» Adding leading zeros...");var t=s.split(":");for(let e=0;e<t.length;e++)for(;t[e].length<4;)t[e]="0"+t[e];s=t.join(":")}else o.verbose&&console.info("ipv6.format() Â» Stripping leading zeros..."),s=e.replace(/(^|(?<=:))0+(?!:)/g,"$1");return o.verbose&&console.info("\n"+(s!==e?s:"Address cannot be formatted!")),s},validate:function(e,o={}){(o={verbose:!0,...o}).verbose&&console.info("ipv6.validate() Â» "+`Validating ${e}...`);const r=e.split(/::?/),n=r[r.length-1];e=!(e.includes("::")&&2<e.split("::").length||/:{3,}/g.test(e)||r.length<2||8<r.length||r.some(e=>!(/^[\dA-Fa-f]{1,4}$/.test(e)||e===n&&t.validate(n.replace(/\/(?:0|(?:[1-2]?\d)|32|96)$/,""),{verbose:!1}))));return o.verbose&&console.info("ipv6.validate() Â» "+`IP is ${e?"":"in"}valid IPv6 address!`),e}};if(require.main!==module)module.exports={ipv4:t,ipv6:e};else{const a="[0m",c="[1;91m",v="[1;33m",p="[1;97m",f={infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};let o=!1,r;for(const d of Object.keys(f))for(const g of Object.keys(f[d]))o||process.argv.forEach(e=>{e.startsWith("-")&&(r=f[d][g].test(e)?void(o=!0):e)});if(r&&(console.error(`
${c}ERROR: Arg [${r}] not recognized.`+a),console.info(`
${v}Valid arguments are below.`+a),i(["infoCmds"]),process.exit(1)),process.argv.some(e=>/^--?h(?:elp)?$/.test(e)))i();else if(process.argv.some(e=>/^--?ve?r?s?i?o?n?$/.test(e)))console.info("v"+require("./package.json").version);else{const m=t.generate({verbose:!1});l(m),console.log(p+m+a)}function i(e=["cmdFormat","formatOptions","infoCmds"]){const o={cmdFormat:[`
${v}generate-ip [commands]`+a],infoCmds:["\nInfo commands:"," -h, --help                  Display help screen."," -v, --version               Show version number."]};e.forEach(e=>{o[e]?.forEach(e=>{{const n=process.stdout.columns||80,s=[],o=e.match(/\S+|\s+/g);let r="";o.forEach(e=>{var o=n-(0===s.length?0:29);r.length+e.length>o&&(s.push(0===s.length?r:r.trimStart()),r=""),r+=e}),s.push(0===s.length?r:r.trimStart()),s.forEach((e,o)=>console.info(0===o?e:" ".repeat(29)+e))}})})}function l(e){e=e.replace(/\s+$/,"").replace(/"/g,'""'),"darwin"===process.platform?s(`printf "${e}" | pbcopy`):"linux"===process.platform?s(`printf "${e}" | xclip -selection clipboard`):"win32"===process.platform&&s(`Set-Clipboard -Value "${e}"`,{shell:"powershell"})}}