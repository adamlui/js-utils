/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/js-utils/tree/main/generate-ip/src
 * Documentation: https://github.com/adamlui/js-utils/tree/main/generate-ip/docs
 */
let fs=require("fs"),log=require(`./log${env.devMode?"":".min"}.js`),path=require("path");(globalThis.app??={}).config={},module.exports={configFilename:"generate-ip.config.mjs",controls:{qty:{type:"param",defaultVal:1,regex:/^--?qu?a?n?ti?t?y(?:=.*|$)/,parser:e=>parseInt(e,10)},config:{type:"param",regex:/^--?config(?:=.*|$)/},ipv6mode:{type:"flag",mode:!0,regex:/^--?(?:ip)?v?6(?:-?mode)?$/},macMode:{type:"flag",mode:!0,regex:/^--?m(?:ac)?(?:-?mode)?$/},quietMode:{type:"flag",regex:/^--?q(?:uiet)?(?:-?mode)?$/},init:{type:"cmd",regex:/^-{0,2}i(?:nit)?$/},help:{type:"cmd",regex:/^--?h(?:elp)?$/},version:{type:"cmd",regex:/^--?ve?r?s?i?o?n?$/}},async initConfigFile(o=this.configFilename){var e=path.resolve(process.cwd(),o);if(fs.existsSync(e))return log.warn(app.msgs.warn_configFileExists+":",e);var i=path.resolve(__dirname,"../../"+(env.devMode?"../":"./data/")+o);if(fs.existsSync(i))fs.copyFileSync(i,e);else{i=require(`./data${env.devMode?"":".min"}.js`),o=app.urls.jsdelivr+"/generate-ip/"+o;log.data(app.msgs.info_fetchingRemoteConfigFrom+` ${o}...`);try{var r=await i.fetch(o);if(!r.ok)return log.warn(`${app.msgs.warn_remoteConfigNotFound}: ${o} (${r.status})`);i.atomicWrite(e,await r.text())}catch(e){return log.warn(app.msgs.warn_remoteConfigFailed+`: ${o} `+e.message)}}log.success(app.msgs.info_configFileCreated+`: ${e}
`),log.tip(app.msgs.tip_editToSetDefaults+"."),log.tip(app.msgs.tip_cliArgsPrioritized+".")},load({args:e=process.argv.slice(2),ctrlKeys:t=Object.keys(this.controls)}={}){t.forEach(e=>{var o=this.controls[e];o.mode||"cmd"==o.type||(app.config[e]??=o.defaultVal??("flag"!=o.type&&""))});let o=null;var i=e.find(e=>this.controls.config.regex.test(e));if(i){/=/.test(i)||log.errorAndExit(`[${i}] `+app.msgs.error_mustIncludePath);i=i.split("=")[1];o=path.isAbsolute(i)?i:path.resolve(process.cwd(),i),fs.existsSync(o)||log.configURLandExit(app.msgs.error_configFileNotFound+":",o)}else for(var r of["mjs","cjs","js"]){r=path.resolve(process.cwd(),this.configFilename.replace(/\.[^.]+$/,"."+r));if(fs.existsSync(r)){o=r;break}}if(o)try{var s=require(o),a=s?.default??s;a&&"object"==typeof a||log.configURLandExit(app.msgs.error_invalidConfigFile+"."),Object.assign(app.config,a)}catch(e){log.configURLandExit(app.msgs.error_failedToLoadConfigFile+":",o,`
`+e.message)}return e.forEach(o=>{if(!/^[^-]|--?(?:config|debug)/.test(o)){var i=t.find(e=>this.controls[e]?.regex?.test(o)),r=(i||log.errorAndExit(`[${o}] ${app.msgs.error_notRecognized}.`),this.controls[i]);if("cmd"!=r.type){let e="param"!=r.type||o.split("=")[1]?.trim();r.mode?app.config.mode=i.replace(/mode$/i,"").toLowerCase():((r=r.parser)&&(e=r(e),isNaN(e)||e<1)&&log.errorAndExit(`[${i}] ${app.msgs.error_nonPositiveNum}.`),app.config[i]=e)}}}),app.config}};