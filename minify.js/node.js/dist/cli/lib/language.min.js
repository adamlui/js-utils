/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/minify.js/tree/main/node.js/src
 * Documentation: https://github.com/adamlui/minify.js/tree/main/node.js/docs
 */
let data=require(`./data${env.devMode?"":".min"}.js`),log=require(`./log${env.devMode?"":".min"}.js`);module.exports={generateRandomLang({includes:e=[],excludes:r=[]}={}){log.prefix="generateRandomLang()";let t=require("fs"),a=require("path"),s=e.length?e:(()=>{var e=a.join(__dirname,"..",".cache"),r=a.join(e,"locales.json");if(t.existsSync(r))try{return JSON.parse(t.readFileSync(r,"utf8"))}catch(e){}var s=a.resolve(process.cwd(),"_locales");return t.existsSync(s)?(s=t.readdirSync(s,{withFileTypes:!0}).filter(e=>e.isDirectory()).map(e=>e.name).filter(e=>/^[a-z]{2}(?:_[A-Z]{2})?$/.test(e)),t.mkdirSync(e,{recursive:!0}),data.atomicWrite(r,JSON.stringify(s,null,2)),s):["en"]})(),n=new Set(r),i="en";return(s=s.filter(e=>!n.has(e))).length&&(i=s[Math.floor(Math.random()*s.length)]),log.debug(`Random language:  ${i}
`),i},async getMsgs(s="en"){log.prefix="getMsgs()";let e=data.flatten(require(`../../${env.devMode?"../../_locales/en/":"data/"}messages.json`));if(!s.startsWith("en")){var t=`${cli.urls.jsdelivr}@${cli.commitHashes.locales}/_locales/`;let r=t+s.replace("-","_")+"/messages.json";for(;(this.msgFetchesTried||=0)<3;)try{e=data.flatten(await(await data.fetch(r)).json()),this.msgFetchesTried=0;break}catch(e){if(this.msgFetchesTried++,3<=this.msgFetchesTried)break;log.debug(r=s.includes("-")&&1==this.msgFetchesTried?r.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):t+"en/messages.json")}}return e},getSysLang(){var e;if(log.prefix="getSysLang()","win32"!=process.platform)return((e=process.env).LANG||e.LANGUAGE||e.LC_ALL||e.LC_MESSAGES||e.LC_NAME||"en").split(".")[0];try{return require("child_process").execSync("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){return log.error("ERROR loading system language:",e.message),"en"}}};