#!/usr/bin/env node
/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/minify.js/tree/main/node.js/src
 * Documentation: https://github.com/adamlui/minify.js/tree/main/node.js/docs
 */
(async()=>{var e,i=process.argv.slice(2);globalThis.env={debugMode:i.some(e=>/^--?debug(?:-?mode)?$/.test(e)),devMode:/[\\/]src(?:[\\/]|$)/i.test(__dirname)};let o=require("node-clipboardy"),t=require("fs"),{generateRandomLang:n,getMsgs:s,getSysLang:r}=require(`./lib/language${env.devMode?"":".min"}.js`),p=require(`./lib/log${env.devMode?"":".min"}.js`),a=require(`../minify${env.devMode?"":".min"}.js`),c=require("path"),g=require(`./lib/settings${env.devMode?"":".min"}.js`);Object.assign(globalThis.app??={},require(`../${env.devMode?"../":"./data/"}app.json`)),p.debug(app.msgs=await s(env.debugMode?n({excludes:["en"]}):r())),app.urls.docs+="/#-command-line-usage";for(e of i){if(g.controls.init.regex.test(e))return g.initConfigFile();if(g.controls.help.regex.test(e))return p.help();if(g.controls.version.regex.test(e))return p.version()}let[l="",f=""]=i.filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),m=c.resolve(process.cwd(),l);l&&!t.existsSync(m)&&(i=m+".js",t.existsSync(i)?m=i:(p.error(`${app.msgs.error_firstArgNotExist}.\n${m} ${app.msgs.error_doesNotExist}.`),p.success(app.msgs.info_exampleValidCmd+`: 
» minify-js . output.min.js`),p.helpCmdAndDocURL(),process.exit(1))),g.load();var d,i=m.endsWith(".js")&&!t.statSync(m).isDirectory()?[m]:a.findJS(m,{recursive:!app.config.noRecursion,verbose:!app.config.quietMode,ignores:(app.config.ignores?.split(",")??[]).map(e=>e.trim())});if(app.config.dryRun)i.length?(p.info(app.msgs.info_filesToBeMinned+":"),i.forEach(e=>console.info(e))):p.info(app.msgs.info_noFilesWillBeMinned+".");else{let n=[],e=[];!app.config.relativeOutput&&t.statSync(m).isDirectory()?(d=a.minify(m,{verbose:!1,mangle:!app.config.noMangle,comment:app.config.comment?.replace(/\\n/g,"\n"),relativeOutput:!1,recursive:!app.config.noRecursion,dotFolders:!!app.config.includeDotFolders,dotFiles:!!app.config.includeDotFiles,rewriteImports:!!app.config.rewriteImports,ignores:app.config.ignores?app.config.ignores.split(",").map(e=>e.trim()):[]}))&&(d.error?n.push(m):e=[].concat(d)):e=i.map(e=>{var i=a.minify(e,{verbose:!app.config.quietMode,mangle:!app.config.noMangle,comment:app.config.comment?.replace(/\\n/g,"\n")});return i.error&&n.push(e),i}).filter(e=>!e.error),app.config.quietMode||(e?.length?(p.success(app.msgs.info_minComplete+"!"),p.data(e.length+" "+app.msgs.info_file+`${1==e.length?"":"s"} ${app.msgs.info_minified}.`)):console.info(app.msgs.info_noFilesProcessed+"."),n.length&&(p.error(n.length+" "+app.msgs.info_file+(1==n.length?"":"s"),app.msgs.info_failedToMinify+":"),n.forEach(e=>console.info(e)))),e?.length&&(app.config.copy&&1==e?.length?(p.data(e[0].code),p.ifNotQuiet(`
${app.msgs.info_copying}...`),o.writeSync(e[0].code)):(p.ifNotQuiet(`
${app.msgs.info_writing}${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcPath:n,relPath:o})=>{let s,r;if(!app.config.relativeOutput&&o){let e=c.resolve(process.cwd(),f||"min"),i=c.dirname(o);s="."!=i?c.join(e,i):e,r=`${c.basename(n,".js")}${app.config.noFilenameChange?"":".min"}.js`}else s=c.join(c.dirname(n),f.endsWith(".js")?c.dirname(f):f||"min"),r=`${f.endsWith(".js")&&l.endsWith(".js")?c.basename(f).replace(/(\.min)?\.js$/,""):c.basename(n,".js")}${app.config.noFilenameChange?"":".min"}.js`;let i=c.join(s,r);t.mkdirSync(s,{recursive:!0}),t.writeFileSync(i,e,"utf8"),p.ifNotQuiet(`  ${p.colors.bg}✓${p.colors.nc} `+c.relative(process.cwd(),i))})))}})();