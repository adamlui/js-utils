#!/usr/bin/env node
/**
 * © 2024–2026 Adam Lui & contributors under the MIT license.
 * Source: https://github.com/adamlui/minify.js/tree/main/node.js/src
 * Documentation: https://github.com/adamlui/minify.js/tree/main/node.js/docs
 */
(async()=>{var e,i=process.argv.slice(2);globalThis.env={debugMode:i.some(e=>/^--?debug(?:-?mode)?$/.test(e)),devMode:/[\\/]src(?:[\\/]|$)/i.test(__dirname)};let s=require("node-clipboardy"),l=require("fs"),{generateRandomLang:n,getMsgs:o,getSysLang:c}=require(`./lib/language${env.devMode?"":".min"}.js`),r=require(`./lib/github${env.devMode?"":".min"}.js`),t=require(`./lib/log${env.devMode?"":".min"}.js`),g=require(`../minify${env.devMode?"":".min"}.js`),a=require("path"),d=require(`./lib/settings${env.devMode?"":".min"}.js`);Object.assign(globalThis.cli??={},require(`../${env.devMode?"../":"./data/"}package-data.json`)),env.sysLang=env.debugMode?n({excludes:["en"]}):c(),cli.msgs=await o(env.sysLang),cli.urls.docs+="/#-command-line-usage",env.sysLang.startsWith("en")||(cli.docLocale=env.sysLang.replace("_","-").toLowerCase(),cli.docLocales=await r.getDirContents({path:"node.js/docs",type:"dir"}),cli.docLocales.includes(cli.docLocale)&&(cli.urls.docs=cli.urls.docs.replace(/\/#.*$/g,`/${cli.docLocale}#readme`)));for(e of i){if(d.controls.init.regex.test(e))return d.initConfigFile();if(d.controls.help.regex.test(e))return t.help();if(d.controls.version.regex.test(e))return t.version()}let[m="",f=""]=i.filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),u=a.resolve(process.cwd(),m);m&&!l.existsSync(u)&&(i=u+".js",l.existsSync(i)?u=i:(t.error(`${cli.msgs.error_firstArgNotExist}.\n${u} ${cli.msgs.error_doesNotExist}.`),t.success(cli.msgs.info_exampleValidCmd+`: 
» minify-js . output.min.js`),t.helpCmdAndDocURL(),process.exit(1))),d.load();var p,i=u.endsWith(".js")&&!l.statSync(u).isDirectory()?[u]:g.findJS(u,{recursive:!cli.config.noRecursion,verbose:!cli.config.quietMode,ignores:(cli.config.ignores?.split(",")??[]).map(e=>e.trim())});if(cli.config.dryRun)i.length?(t.info(cli.msgs.info_filesToBeMinned+":"),i.forEach(e=>console.info(e))):t.info(cli.msgs.info_noFilesWillBeMinned+".");else{let n=[],e=[];!cli.config.relativeOutput&&l.statSync(u).isDirectory()?(p=g.minify(u,{verbose:!1,mangle:!cli.config.noMangle,comment:cli.config.comment?.replace(/\\n/g,"\n"),relativeOutput:!1,recursive:!cli.config.noRecursion,dotFolders:cli.config.includeDotFolders,dotFiles:cli.config.includeDotFiles,rewriteImports:cli.config.rewriteImports,ignores:cli.config.ignores?cli.config.ignores.split(",").map(e=>e.trim()):[]}))&&(p.error?n.push(u):e=[].concat(p)):e=i.map(e=>{var i=g.minify(e,{verbose:!cli.config.quietMode,mangle:!cli.config.noMangle,comment:cli.config.comment?.replace(/\\n/g,"\n")});return i.error&&n.push(e),i}).filter(e=>!e.error),cli.config.quietMode||(e?.length?(t.success(cli.msgs.info_minComplete+"!"),t.data(e.length+" "+cli.msgs.info_file+`${1==e.length?"":"s"} ${cli.msgs.info_minified}.`)):console.info(cli.msgs.info_noFilesProcessed+"."),n.length&&(t.error(n.length+" "+cli.msgs.info_file+(1==n.length?"":"s"),cli.msgs.info_failedToMinify+":"),n.forEach(e=>console.info(e)))),e?.length&&(cli.config.copy&&1==e?.length?(t.data(e[0].code),t.ifNotQuiet(`
${cli.msgs.info_copyingToClip}...`),s.writeSync(e[0].code)):(t.ifNotQuiet(`
${cli.msgs.info_writing}${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcPath:n,relPath:s})=>{let o,c;if(!cli.config.relativeOutput&&s){let e=a.resolve(process.cwd(),f||"min"),i=a.dirname(s);o="."!=i?a.join(e,i):e,c=`${a.basename(n,".js")}${cli.config.noFilenameChange?"":".min"}.js`}else o=a.join(a.dirname(n),f.endsWith(".js")?a.dirname(f):f||"min"),c=`${f.endsWith(".js")&&m.endsWith(".js")?a.basename(f).replace(/(\.min)?\.js$/,""):a.basename(n,".js")}${cli.config.noFilenameChange?"":".min"}.js`;let i=a.join(o,c);l.mkdirSync(o,{recursive:!0}),l.writeFileSync(i,e,"utf8"),t.ifNotQuiet(`  ${t.colors.bg}✓${t.colors.nc} `+a.relative(process.cwd(),i))})))}})();