let fs=require("fs"),path=require("path"),uglifyJS=require("uglify-js");function findJS(s,i={}){let e=app.urls.docs+"/#findjssearchdir-options",n="findJS() » ";var r={recursive:!0,verbose:!0,dotFolders:!1,dotFiles:!1,ignores:[]};if("string"!=typeof s)console.error(n+"ERROR: 1st arg <searchDir> must be a string."),console.info(n+"For more help, please visit "+e);else{var o=path.resolve(process.cwd(),s);if(fs.existsSync(o)){if(validateOptions(i,r,e,"findJS('assets/js', { verbose: false, dotFoldes: true })")){(i={...r,...i}).ignoreFiles&&(i.ignores=[...i.ignores,...i.ignoreFiles]);let e=fs.readdirSync(s),o=[];return i.verbose&&!i.isRecursing&&console.info(n+"Searching for unminified JS files..."),e.forEach(e=>{let r=path.resolve(s,e);i.ignores.some(o=>o.endsWith("/")?r.split(path.sep).some(e=>e==o.replace(/\/$/,"")):e==o)?i.verbose&&console.info(n+`** ${e} ignored`):fs.statSync(r).isDirectory()&&"node_modules"!=e&&i.recursive&&(i.dotFolders||!e.startsWith("."))?o.push(...findJS(r,{...i,isRecursing:!0})):!/\.js(?<!\.min\.js)$/.test(e)||!i.dotFiles&&e.startsWith(".")||o.push(r)}),i.verbose&&!i.isRecursing&&(console.info(n+"Search complete! "+`${o.length||"No"} file${1==o.length?"":"s"} found.`),"minify"!=findJS.caller?.name)&&"undefined"!=typeof window&&console.info(n+"Check returned array."),i.isRecursing||o.length?o:[]}}else console.error(n+"ERROR: 1st arg <searchDir> must be an existing directory."),console.error(n+o+" does not exist."),console.info(n+"For more help, please visit "+e)}}function minify(i,n={}){let e=app.urls.docs+"/#minifyinput-options",t="minify() » ";var o={recursive:!0,verbose:!0,dotFolders:!1,dotFiles:!1,mangle:!0,rewriteImports:!1,relativeOutput:!1,ignores:[],comment:""};if("string"!=typeof i)console.error(t+"ERROR: 1st arg <input> must be a string."),console.info(t+"For more help, please visit "+e);else if(validateOptions(n,o,e,"minify('assets/js', { recursive: false, mangle: false })")){(n={...o,...n}).ignoreFiles&&(n.ignores=[...n.ignores,...n.ignoreFiles]);let s={mangle:!!n.mangle&&{toplevel:!1}};try{var r,c=fs.openSync(i,fs.constants.O_RDONLY),l=fs.fstatSync(c);if(l.isFile()){if(!/\.[cm]?jsx?$/i.test(i))return r=new Error(t+`ERROR: ${i} is not a JavaScript file (.js, .mjs, .cjs, .jsx)`),console.error(r.message),fs.closeSync(c),{code:"",srcPath:path.resolve(process.cwd(),i),error:r};n.verbose&&console.info(t+`** Minifying ${i}...`);var a=Buffer.alloc(l.size),f=(fs.readSync(c,a,0,l.size,0),fs.closeSync(c),uglifyJS.minify(a.toString("utf8"),s));return n.comment&&(f.code=p(f.code,n.comment)),f.error?console.error(t+"ERROR: "+f.error.message):n.verbose&&"undefined"!=typeof window&&console.info(t+"Minification complete! Check returned object."),{code:f.code,srcPath:path.resolve(process.cwd(),i),error:f.error}}fs.closeSync(c);var d=findJS(i,n)?.map(e=>{n.verbose&&console.info(t+`** Minifying ${e}...`);var o=fs.readFileSync(e,"utf8"),o=uglifyJS.minify(o,s),r=n.relativeOutput?void 0:path.relative(path.resolve(process.cwd(),i),e);return n.comment&&(o.code=p(o.code,n.comment)),o.error&&console.error(t+"ERROR: "+o.error.message),{code:o.code,srcPath:e,relPath:r,error:o.error}}).filter(e=>!e.error);if(n.verbose&&(d.length&&"undefined"!=typeof window?console.info(t+"Minification complete! Check returned object."):console.info(t+"No unminified JavaScript files processed.")),n.rewriteImports&&d&&1<d.length){n.verbose&&console.info(t+"** Rewriting import paths...");let e=d.map(e=>path.basename(e.srcPath,".js"));d.forEach(s=>e.forEach(e=>{var o=new RegExp(`(\\./?)?\\b${e}\\.js(['"])`,"g"),r=s.code;s.code=s.code.replace(o,`$1${e}.min.js$2`),r!=s.code&&n.verbose&&console.info(t+`Updated ${e}.js in `+path.basename(s.srcPath))})),n.verbose&&console.info(t+"Import paths rewritten.")}return d}catch(e){if("ENOENT"==e.code)return n.verbose&&!process.argv.some(e=>e.includes("gulp"))&&console.info(t+"** Minifying passed source code..."),o=uglifyJS.minify(i,s),n.comment&&(o.code=p(o.code,n.comment)),o.error?console.error(t+"ERROR: "+o.error.message):n.verbose&&!process.argv.some(e=>e.includes("gulp"))&&console.info(t+"Minification complete! Check returned object."),{code:o.code,srcPath:void 0,error:o.error};throw e}function p(e,o){var r,o=o.split("\n").map(e=>" * "+e).join("\n"),s=e.indexOf("#!");return 0<=s?(s=e.indexOf("\n",s)+1,r=e.slice(s),/^\s*\/\*\*/.test(r)?e.slice(0,s)+r.replace(/^\s*\/\*\*/,`/**
/**
 *  © 2023–2026 Adam Lui & contributors under the MIT license.
 *  Source: https://github.com/adamlui/minify.js/tree/main/node.js/src
 *  Documentation: https://github.com/adamlui/minify.js/tree/main/node.js/docs
 */
`+o):e.slice(0,s)+`/**
${o}
 */
`+r):`/**
${o}
 */
`+e}}}function validateOptions(e,o,r,s){let i=JSON.stringify(o,void 0,2).replace(/"([^"]+)":/g,"$1:").replace(/"/g,"'").replace(/\n\s*/g," "),n=Object.keys(o).join(", "),t=Object.keys(o).filter(e=>"boolean"==typeof o[e]),c=Object.keys(o).filter(e=>Number.isInteger(o[e])),l=Object.keys(o).filter(e=>Array.isArray(o[e])),a=`${validateOptions.caller?.name||"validateOptions"}() » `;var f,d=s.split(",").findIndex(e=>e.trim().startsWith("{"))+1;function p(){console.info(a+"For more help, please visit "+r)}if(d+=["st","nd","rd"][d-1]||"th","object"!=typeof e)return console.error(a+`ERROR: ${"0th"==d?"[O":d+" arg [o"}ptions] can only be an object of key/values.`),console.info(a+"Example valid call: "+s),console.info(a+`Valid options: [ ${n} ]`),console.info(a+"If omitted, default settings are: "+i),p(),!1;for(f in e)if("isRecursing"==f||Object.prototype.hasOwnProperty.call(o,f)){if(t.includes(f)&&"boolean"!=typeof e[f])return console.error(a+`ERROR: [${f}] option can only be \`true\` or \`false\`.`),p(),!1;if(c.includes(f)){if(e[f]=parseInt(e[f],10),isNaN(e[f])||e[f]<1)return console.error(a+`ERROR: [${f}] option can only be an integer > 0.`),p(),!1}else if(l.includes(f))if("string"!=typeof e[f]||e[f].includes(",")){if(!Array.isArray(e[f]))return console.error(a+`ERROR: [${f}] option can only be an array.`),p(),!1}else e[f]=[e[f]]}return!0}globalThis.app=require(`${__dirname.match(/[\\/]src/)?"../":"./data/"}app.json`);let mjsAliases={minify:["build","Build","compile","Compile","compress","Compress","Minify"],findJS:["find","Find","findjs","findJs","Findjs","FindJs","FindJS","search","Search"]};module.exports={minify:minify,findJS:findJS};for(let o in mjsAliases)mjsAliases[o].forEach(e=>module.exports[e]=module.exports[o]);