#!/usr/bin/env node
/**
 *  © 2023–2024 Adam Lui & contributors under the MIT license.
 *  Source: https://code.minify-js.org/node.js
 *  Documentation: https://docs.minify-js.org/node.js
 */
const fs=require("fs"),path=require("path"),uglifyJS=require("uglify-js");function findJS(n,r={}){var e="https://docs.minify-js.org/node.js/#findjssearchdir-options",o={recursive:!0,verbose:!0,dotFolders:!1,dotFiles:!1,ignoreFiles:[]};if("string"!=typeof n)console.error("findJS() » ERROR: 1st arg <searchDir> must be a string."),console.info("findJS() » For more help, please visit "+e);else{var i=path.resolve(process.cwd(),n);if(fs.existsSync(i)){if(validateOptions(r,o,e,"findJS('assets/js', { verbose: false, dotFoldes: true })")){r={...o,...r};const s=fs.readdirSync(n),t=[];return r.verbose&&!r.isRecursing&&console.info("findJS() » Searching for unminified JS files..."),s.forEach(e=>{var o,i=path.resolve(n,e);fs.statSync(i).isDirectory()&&"node_modules"!=e&&r.recursive&&(r.dotFolders||!e.startsWith("."))?(o={...r,isRecursing:!0},t.push(...findJS(i,o))):!/\.js(?<!\.min\.js)$/.test(e)||!r.dotFiles&&e.startsWith(".")||r.ignoreFiles.includes(e)?r.verbose&&r.ignoreFiles.includes(e)&&console.info(`findJS() » ** ${e} ignored due to [options.ignoreFiles]`):t.push(i)}),!r.isRecursing&&r.verbose&&(console.info("findJS() » Search complete! "+(0==t.length?"No":t.length)+` file${0==t.length||1<t.length?"s":""} found.`),"minify"==findJS.caller.name||process.argv.some(e=>e.includes("gulp"))||/cli(?:\.min)?\.js$/.test(require.main.filename)||console.info("findJS() » Check returned array.")),r.isRecursing||0<t.length?t:[]}}else console.error("findJS() » ERROR: 1st arg <searchDir> must be an existing directory."),console.error(`findJS() » ${i} does not exist.`),console.info("findJS() » For more help, please visit "+e)}}function minify(e,n={}){var o="https://docs.minify-js.org/node.js/#minifyinput-options",i={recursive:!0,verbose:!0,dotFolders:!1,dotFiles:!1,ignoreFiles:[],mangle:!0,comment:""};if("string"!=typeof e)console.error("minify() » ERROR: 1st arg <input> must be a string."),console.info("minify() » For more help, please visit "+o);else if(validateOptions(n,i,o,"minify('assets/js', { recursive: false, mangle: false })")){const s={mangle:(n={...i,...n}).mangle};return fs.existsSync(e)?e.endsWith(".js")?(n.verbose&&console.info(`minify() » ** Minifying ${e}...`),o=uglifyJS.minify(fs.readFileSync(e,"utf8"),s),n.comment&&(o.code=r(o.code)),o.error?console.error("minify() » ERROR: "+o.error.message):!n.verbose||process.argv.some(e=>e.includes("gulp"))||/cli(?:\.min)?\.js$/.test(require.main.filename)||console.info("minify() » Minification complete! Check returned object."),{code:o.code,srcPath:path.resolve(process.cwd(),e),error:o.error}):(i=findJS(e,{recursive:n.recursive,verbose:n.verbose,dotFolders:n.dotFolders,dotFiles:n.dotFiles,ignoreFiles:n.ignoreFiles})?.map(e=>{n.verbose&&console.info(`minify() » ** Minifying ${e}...`);var o=fs.readFileSync(e,"utf8"),o=uglifyJS.minify(o,s);return n.comment&&(o.code=r(o.code)),o.error&&console.error("minify() » ERROR: "+o.error.message),{code:o.code,srcPath:e,error:o.error}}).filter(e=>!e.error),n.verbose&&(0<i.length?console.info("minify() » Minification complete! Check returned object."):console.info("minify() » No unminified JavaScript files processed.")),i):(n.verbose&&!process.argv.some(e=>e.includes("gulp"))&&console.info("minify() » ** Minifying passed source code..."),o=uglifyJS.minify(e,s),n.comment&&(o.code=r(o.code)),o.error?console.error("minify() » ERROR: "+o.error.message):n.verbose&&!process.argv.some(e=>e.includes("gulp"))&&console.info("minify() » Minification complete! Check returned object."),{code:o.code,srcPath:void 0,error:o.error});function r(e){var o=n.comment.split("\n").map(e=>" * "+e).join("\n"),i=e.indexOf("#!");return 0<=i?(i=e.indexOf("\n",i)+1,e.slice(0,i)+`/**
${o}
 */
`+e.slice(i)):`/**
${o}
 */
`+e}}}function validateOptions(e,o,i,n){const r=JSON.stringify(o,null,2).replace(/"([^"]+)":/g,"$1:").replace(/"/g,"'").replace(/\n\s*/g," "),s=Object.keys(o).join(", "),t=Object.keys(o).filter(e=>"boolean"==typeof o[e]),l=Object.keys(o).filter(e=>Number.isInteger(o[e])),c=Object.keys(o).filter(e=>Array.isArray(o[e]));let f="validateOptions() » ";try{f=validateOptions.caller?.name+"() » "}catch(e){}var a=n.split(",").findIndex(e=>e.trim().startsWith("{"))+1,d=(a+=["st","nd","rd"][a-1]||"th",()=>{console.info(`${f}Valid options: [ ${s} ]`),console.info(f+"If omitted, default settings are: "+r)}),u=()=>{console.info(f+"For more help, please visit "+i)};if("object"!=typeof e)return console.error(f+`ERROR: ${"0th"==a?"[O":a+" arg [o"}ptions] can only be an object of key/values.`),console.info(f+"Example valid call: "+n),d(),u(),!1;for(const p in e){if("isRecursing"!=p&&!Object.prototype.hasOwnProperty.call(o,p))return console.error(`${f}ERROR: \`${p}\` is an invalid option.`),d(),u(),!1;if(t.includes(p)){if("mangle"==p){var m=()=>console.error(f+"ERROR: [mangle] option can only be `true`, `false`, or an object w/ key [toplevel] set to `true` or `false`.");if("object"==typeof e.mangle){for(const y in e.mangle)if(!["toplevel"].includes(y)||"boolean"!=typeof e.mangle[y])return m(),u(),!1}else if("boolean"!=typeof e.mangle)return m(),u(),!1}else if("boolean"!=typeof e[p])return console.error(`${f}ERROR: [${p}] option can only be \`true\` or \`false\`.`),u(),!1}else if(l.includes(p)){if(e[p]=parseInt(e[p],10),isNaN(e[p])||e[p]<1)return console.error(`${f}ERROR: [${p}] option can only be an integer > 0.`),u(),!1}else if(c.includes(p))if("string"!=typeof e[p]||e[p].includes(",")){if(!Array.isArray(e[p]))return console.error(`${f}ERROR: [${p}] option can only be an array.`),u(),!1}else e[p]=[e[p]]}return!0}const funcAliases={minify:["compress"],findJS:["find","Find","findjs","findJs","Findjs","FindJs","FindJS","search","Search"]};module.exports={minify:minify,findJS:findJS};for(const ba in funcAliases)funcAliases[ba].forEach(e=>module.exports[e]=module.exports[ba]);