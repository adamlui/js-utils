#!/usr/bin/env node
/**
 *  Â© 2023â€“2025 Adam Lui & contributors under the MIT license.
 *  Source: https://code.minify-js.org/node.js
 *  Documentation: https://docs.minify-js.org/node.js
 */
let pkgName="@adamlui/minify.js",copyright="Â© 2024â€“2025 Adam Lui & contributors under the MIT license.",cmdFormat="minify-js [inputPath] [outputPath] [options]",srcURL="https://code.minify-js.org/node.js",docURL="https://docs.minify-js.org/node.js/#-command-line-usage",latestLocaleCommitHash="b84f3d2";(async()=>{let n=require(__dirname.match(/src/)?"./minify":"./minify.min"),a=require("fs"),c=require("path"),s=require("node-clipboardy"),i=require("child_process").execSync,r="[0m",m="[1;91m",d="[1;33m",f="[1;92m",p="[1;97m",g="en";if("win32"==process.platform)try{g=i("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){b("Error loading system language: "+e)}else{var h=process.env;g=(h.LANG||h.LANGUAGE||h.LC_ALL||h.LC_MESSAGES||h.LC_NAME||"en").split(".")[0]}let u={};h=new Promise((s,r)=>{let t=`https://cdn.jsdelivr.net/gh/adamlui/minify.js@7d9303ba4d54953b22ec7136a557df2923069fc4/_locales/`,e=`${g?g.replace("-","_"):"en"}/`,l=t+e+"messages.json",a=0;_(l).then(async function o(i){try{let e=await i.json(),o={};for(var n in e)"object"==typeof e[n]&&"message"in e[n]&&(o[n]=e[n].message);s(o)}catch(e){if(3==++a)return s({});_(l=g.includes("-")&&1==a?l.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):t+"en/messages.json").then(o).catch(r)}}).catch(r)});try{u=await h}catch(e){b("Error fetching messages: "+e)}let $={},t={flags:{dryRun:/^--?(?:n|dry-?run)$/,includeDotFolders:/^--?(?:dd?|(?:include-?)?dot-?(?:folder|dir(?:ector(?:y|ie))?)s?=?(?:true|1)?)$/,includeDotFiles:/^--?(?:df|D|(?:include-?)?dot-?files?=?(?:true|1)?)$/,noRecursion:/^--?(?:R|(?:disable|no)-?recursi(?:on|ve)|recursi(?:on|ve)=(?:false|0))$/,noMangle:/^--?(?:M|(?:disable|no)-?mangle|mangle=(?:false|0))$/,noFilenameChange:/^--?(?:X|(?:disable|no)-?(?:file)?name-?change|(?:file)?name-?change=(?:false|0))$/,cloneFolders:/^--?(?:C|clone-?folders?=?(?:true|1)?)$/,copy:/^--?c(?:opy)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},paramOptions:{ignoreFiles:/^--?(?:ignore|skip|exclude)(?:d?-?files?)?(?:=.*|$)/,comment:/^--?comments?(?:=.*|$)/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(o=>{var e,i,n;o.startsWith("-")&&(n=Object.keys(t.flags).find(e=>t.flags[e].test(o)),e=Object.keys(t.paramOptions).find(e=>t.paramOptions[e].test(o)),i=Object.keys(t.infoCmds).find(e=>t.infoCmds[e].test(o)),n?$[n]=!0:e?(/=.+/.test(o)||(console.error(`
${m+(u.prefix_error||"ERROR")}: `+`Arg [--${o.replace(/-/g,"")}] `+`${u.error_noEqual||"requires '=' followed by a value"}.${r}`),j(),process.exit(1)),n=o.split("=")[1],$[e]=parseInt(n)||n):i||(console.error(`
${m+(u.prefix_error||"ERROR")}: `+`Arg [${o}] ${u.error_notRecognized||"not recognized"}.[0m`),console.info(`
${d+(u.info_validArgs||"Valid arguments are below")}.[0m`),v(["flags","paramOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>t.infoCmds.help.test(e)))v();else if(process.argv.some(e=>t.infoCmds.version.test(e))){h=i(`npm view ${pkgName} version`).toString().trim()||"none";let e,o=process.cwd();for(;"/"!=o;){var l=c.join(o,"package.json");if(a.existsSync(l)){l=require(l);e=(l.dependencies?.[pkgName]||l.devDependencies?.[pkgName])?.match(/^\d+\.\d+\.\d+$/)?.[0]||"none";break}o=c.dirname(o)}console.info(`
${u.prefix_globalVer||"Global version"}: `+h),console.info(`${u.prefix_localVer||"Local version"}: `+e)}else{let[t="",l=""]=process.argv.slice(2).filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),o=c.resolve(process.cwd(),t);t&&!a.existsSync(o)&&(h=o+".js",a.existsSync(h)?o=h:(console.error(`
${m+(u.prefix_error||"ERROR")}: `+`${u.error_firstArgNotExist||"First argument can only be an existing file or directory"}.`+`
${o} ${u.error_doesNotExist||"does not exist"}.[0m`),console.info(`
${f}${u.info_exampleValidCmd||"Example valid command"}: `+`
Â» minify-js . output.min.js[0m`),j(),process.exit(1)));var y,h=o.endsWith(".js")&&!a.statSync(o).isDirectory()?[o]:n.findJS(o,{recursive:!$.noRecursion,verbose:!$.quietMode,ignoreFiles:($.ignoreFiles?.split(",")??[]).map(e=>e.trim())});if($.dryRun)h.length?(console.info(`
${d+(u.info_filesToBeMinned||"JS files to be minified")}:[0m`),h.forEach(e=>console.info(e))):console.info(`
${d+(u.info_noFilesWillBeMinned||"No JS files will be minified")}.[0m`);else{let i=[],e=[];$.cloneFolders&&a.statSync(o).isDirectory()?(y=n.minify(o,{verbose:!$.quietMode,mangle:!$.noMangle,comment:$.comment?.replace(/\\n/g,"\n"),cloneFolders:!0,recursive:!$.noRecursion,dotFolders:!!$.includeDotFolders,dotFiles:!!$.includeDotFiles,ignoreFiles:$.ignoreFiles?$.ignoreFiles.split(",").map(e=>e.trim()):[]}),Array.isArray(y)?e=y:y&&y.error?i.push(o):y&&(e=[y])):e=h.map(e=>{var o=n.minify(e,{verbose:!$.quietMode,mangle:!$.noMangle,comment:$.comment?.replace(/\\n/g,"\n")});return o.error&&i.push(e),o}).filter(e=>!e.error),e?.length?(b(`
${f+(u.info_minComplete||"Minification complete")}![0m`),b(p+e.length+" "+(u.info_file||"file")+`${1<e.length?"s":""} ${u.info_minified||"minified"}.${r}`)):b(`
${d+(u.info_noFilesProcessed||"No unminified JavaScript files processed")}.[0m`),i.length&&(b(`
${m+i.length} `+(u.info_file||"file")+`${1<i.length?"s":""} ${u.info_failedToMinify||"failed to minify"}:${r}`),i.forEach(e=>b(e))),0!=e?.length&&($.copy&&1==e?.length?(console.log(`
`+p+e[0].code+r),b(`
${u.info_copying||"Copying to clipboard"}...`),s.writeSync(e[0].code)):(b(`
${u.info_writing||"Writing to file"}${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcPath:i,relPath:n})=>{let s,r;if($.cloneFolders&&n&&l){let e=c.resolve(process.cwd(),l),o=c.dirname(n);s="."!=o?c.join(e,o):e,r=c.basename(i,".js")+`${$.noFilenameChange?"":".min"}.js`}else s=c.join(c.dirname(i),(/so?u?rce?$/.test(c.dirname(i))?"../":"")+(l.endsWith(".js")?c.dirname(l):l||"min")),r=(l.endsWith(".js")&&t.endsWith(".js")?c.basename(l).replace(/(\.min)?\.js$/,""):c.basename(i,".js"))+`${$.noFilenameChange?"":".min"}.js`;let o=c.join(s,r);a.existsSync(s)||a.mkdirSync(s,{recursive:!0}),a.writeFileSync(o,e,"utf8"),b(`  ${f}âœ“[0m `+c.relative(process.cwd(),o))})))}}function _(n){return new Promise((i,e)=>{var o=n.match(/^([^:]+):\/\//)[1];/^https?$/.test(o)||e(new Error(`${u.error_invalidURL||"Invalid URL"}.`)),require(o).get(n,e=>{let o="";e.on("data",e=>o+=e),e.on("end",()=>i({json:()=>JSON.parse(o)}))}).on("error",e)})}function v(e=["header","usage","pathArgs","flags","paramOptions","infoCmds"]){var o=`[106m[30m ${pkgName.replace(/^@[^/]+\//,"")} [0m `;let i={header:["\nâ”œ "+o+(u.appCopyright||copyright),o+(u.prefix_source||"Source")+": "+srcURL],usage:[`
${p}o ${u.helpSection_usage||"Usage"}:[0m`,` ${p}Â» `+f+cmdFormat+r],pathArgs:[`
${p}o ${u.helpSection_pathArgs||"Path arguments"}:[0m`," [inputPath]                         "+`${u.inputPathDesc_main||"Path to JS file or directory containing JS files to be minified"}, `+`${u.inputPathDesc_extra||"relative to the current working directory"}.`," [outputPath]                        "+`${u.outputPathDesc_main||"Path to file or directory where minified files will be stored"}, `+`${u.outputPathDesc_extra||"relative to original file location (if not provided, min/ is used)"}.`],flags:[`
${p}o ${u.helpSection_flags||"Boolean options"}:[0m`," -n, --dry-run                       "+`${u.optionDesc_dryRun||"Don't actually minify the file(s), just show if they will be processed"}.`,` -d, --include-dotfolders            ${u.optionDesc_dotfolders||"Include dotfolders in file search"}.`,` -D, --include-dotfiles              ${u.optionDesc_dotfiles||"Include dotfiles in file search"}.`,` -R, --no-recursion                  ${u.optionDesc_noRecursion||"Disable recursive file searching"}.`,` -M, --no-mangle                     ${u.optionDesc_noMangle||"Disable mangling names"}.`," -X, --no-filename-change            "+(u.optionDesc_noFilenameChange||"Disable changing file extension to .min.js"),` -c, --copy                          ${u.optionDesc_copy||"Copy minified code to clipboard instead of writing to file if single source file is processed"}.`,` -C, --clone-folders                 ${u.optionDesc_cloneFolders||"Preserve folder structure in output directory"}.`,` -q, --quiet                         ${u.optionDesc_quiet||"Suppress all logging except errors"}.`],paramOptions:[`
${p}o ${u.helpSection_paramOptions||"Parameter options"}:[0m`,`--ignore-files="file1.js,file2.js"   ${u.optionDesc_ignoreFiles||"Files to exclude from minification"}.`,`--comment="comment"                  ${u.optionDesc_commentMain||"Prepend header comment to minified code"}.`+` ${u.optionDesc_commentExtra||"Separate by line using '\\n'"}.`],infoCmds:[`
${p}o ${u.helpSection_infoCmds||"Info commands"}:[0m`," -h, --help                          "+(u.optionDesc_help||"Display help screen."),` -v, --version                       ${u.optionDesc_version||"Show version number"}.`]};e.forEach(t=>i[t]?.forEach(o=>{{var r=/header|usage/.test(t)?1:37;let i=process.stdout.columns||80,n=[],e=o.match(/\S+|\s+/g),s="";e.forEach(e=>{var o=i-(n.length?r:0);s.length+"| ".length+e.length>o&&(n.push(n.length?s.trimStart():s),s=""),s+=e}),n.push(n.length?s.trimStart():s),n.forEach((e,o)=>console.info("| "+(0==o?e:" ".repeat(r)+e)))}})),console.info(`
${u.info_moreHelp||"For more help"}, ${u.info_visit||"visit"}: `+p+docURL+r)}function j(){console.info(`
${u.info_moreHelp||"For more help"}, ${u.info_type||"type"} minify-js --help' ${u.info_or||"or"} ${u.info_visit||"visit"}
`+p+docURL+r)}function b(e){$.quietMode||console.info(e)}})();