#!/usr/bin/env node
/**
 *  Â© 2023â€“2026 Adam Lui & contributors under the MIT license.
 *  Source: https://code.minify-js.org/node.js
 *  Documentation: https://docs.minify-js.org/node.js
 */
let pkgName="@adamlui/minify.js",copyright="Â© 2024â€“2026 Adam Lui & contributors under the MIT license.",cmdFormat="minify-js [inputPath] [outputPath] [options]",srcURL="https://code.minify-js.org/node.js",docURL="https://docs.minify-js.org/node.js/#-command-line-usage",latestLocaleCommitHash="5f87114";(async()=>{let n=require(__dirname.match(/src/)?"./minify":"./minify.min"),l=require("fs"),c=require("path"),t=require("node-clipboardy"),o=require("child_process").execSync,r="[0m",m="[1;91m",p="[1;33m",f="[1;92m",d="[1;97m",u="en";if("win32"==process.platform)try{u=o("(Get-Culture).TwoLetterISOLanguageName",{shell:"powershell",encoding:"utf-8"}).trim()}catch(e){console.error("ERROR loading system language: "+e.message)}else{var g=process.env;u=(g.LANG||g.LANGUAGE||g.LC_ALL||g.LC_MESSAGES||g.LC_NAME||"en").split(".")[0]}let h={};g=new Promise((t,r)=>{let s=`https://cdn.jsdelivr.net/gh/adamlui/minify.js@31e05d0ca0b45729e9c7b0cc6e72a3335ee547a3/_locales/`,e=`${u?u.replace("-","_"):"en"}/`,a=s+e+"messages.json",l=0;_(a).then(async function i(o){try{let e=await o.json(),i={};for(var n in e)"object"==typeof e[n]&&"message"in e[n]&&(i[n]=e[n].message);t(i)}catch(e){if(3==++l)return t({});_(a=u.includes("-")&&1==l?a.replace(/([^_]*)_[^/]*(\/.*)/,"$1$2"):s+"en/messages.json").then(i).catch(r)}}).catch(r)});try{h=await g}catch(e){console.error("ERROR fetching messages: "+e.message)}let $={},s={flags:{dryRun:/^--?(?:n|dry-?run)$/,includeDotFolders:/^--?(?:dd?|(?:include-?)?dot-?(?:folder|dir(?:ector(?:y|ie))?)s?=?(?:true|1)?)$/,includeDotFiles:/^--?(?:df|D|(?:include-?)?dot-?files?=?(?:true|1)?)$/,noRecursion:/^--?(?:R|(?:disable|no)-?recursi(?:on|ve)|recursi(?:on|ve)=(?:false|0))$/,noMangle:/^--?(?:M|(?:disable|no)-?mangle|mangle=(?:false|0))$/,noFilenameChange:/^--?(?:X|(?:disable|no)-?(?:file)?name-?change|(?:file)?name-?change=(?:false|0))$/,rewriteImports:/^--?(?:i|rewrite-?imports?=?(?:true|1)?)$/,relativeOutput:/^--?(?:r|relative-?output?=?(?:true|1)?)$/,copy:/^--?c(?:opy)?$/,quietMode:/^--?q(?:uiet)?(?:-?mode)?$/},paramOptions:{ignores:/^--?ignores?(?:=.*|$)/,comment:/^--?comments?(?:=.*|$)/},infoCmds:{help:/^--?h(?:elp)?$/,version:/^--?ve?r?s?i?o?n?$/}};if(process.argv.forEach(i=>{var e,o,n;i.startsWith("-")&&(n=Object.keys(s.flags).find(e=>s.flags[e].test(i)),e=Object.keys(s.paramOptions).find(e=>s.paramOptions[e].test(i)),o=Object.keys(s.infoCmds).find(e=>s.infoCmds[e].test(i)),n?$[n]=!0:e?(/=.+/.test(i)||(console.error(`
${m+(h.prefix_error||"ERROR")}: `+`Arg [--${i.replace(/-/g,"")}] `+`${h.error_noEqual||"requires '=' followed by a value"}.${r}`),j(),process.exit(1)),n=i.split("=")[1],$[e]=parseInt(n)||n):o||(console.error(`
${m+(h.prefix_error||"ERROR")}: `+`Arg [${i}] ${h.error_notRecognized||"not recognized"}.[0m`),console.info(`
${p+(h.info_validArgs||"Valid arguments are below")}.[0m`),v(["flags","paramOptions","infoCmds"]),process.exit(1)))}),process.argv.some(e=>s.infoCmds.help.test(e)))v();else if(process.argv.some(e=>s.infoCmds.version.test(e))){g=o(`npm view ${pkgName} version`).toString().trim()||"none";let e,i=process.cwd();for(;"/"!=i;){var a=c.join(i,"package.json");if(l.existsSync(a)){a=require(a);e=(a.dependencies?.[pkgName]||a.devDependencies?.[pkgName])?.match(/^[~^>=]?\d+\.\d+\.\d+$/)?.[1]||"none";break}i=c.dirname(i)}console.info(`
${h.prefix_globalVer||"Global version"}: `+g),console.info(`${h.prefix_localVer||"Local version"}: `+e)}else{let[s="",a=""]=process.argv.slice(2).filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),i=c.resolve(process.cwd(),s);s&&!l.existsSync(i)&&(g=i+".js",l.existsSync(g)?i=g:(console.error(`
${m+(h.prefix_error||"ERROR")}: `+`${h.error_firstArgNotExist||"First argument can only be an existing file or directory"}.`+`
${i} ${h.error_doesNotExist||"does not exist"}.[0m`),console.info(`
${f}${h.info_exampleValidCmd||"Example valid command"}: `+`
Â» minify-js . output.min.js[0m`),j(),process.exit(1)));var y,g=i.endsWith(".js")&&!l.statSync(i).isDirectory()?[i]:n.findJS(i,{recursive:!$.noRecursion,verbose:!$.quietMode,ignores:($.ignores?.split(",")??[]).map(e=>e.trim())});if($.dryRun)g.length?(console.info(`
${p+(h.info_filesToBeMinned||"JS files to be minified")}:[0m`),g.forEach(e=>console.info(e))):console.info(`
${p+(h.info_noFilesWillBeMinned||"No JS files will be minified")}.[0m`);else{let o=[],e=[];!$.relativeOutput&&l.statSync(i).isDirectory()?(y=n.minify(i,{verbose:!1,mangle:!$.noMangle,comment:$.comment?.replace(/\\n/g,"\n"),relativeOutput:!1,recursive:!$.noRecursion,dotFolders:!!$.includeDotFolders,dotFiles:!!$.includeDotFiles,rewriteImports:!!$.rewriteImports,ignores:$.ignores?$.ignores.split(",").map(e=>e.trim()):[]}))&&(y.error?o.push(i):e=[].concat(y)):e=g.map(e=>{var i=n.minify(e,{verbose:!$.quietMode,mangle:!$.noMangle,comment:$.comment?.replace(/\\n/g,"\n")});return i.error&&o.push(e),i}).filter(e=>!e.error),e?.length?(S(`
${f+(h.info_minComplete||"Minification complete")}![0m`),S(d+e.length+" "+(h.info_file||"file")+`${1<e.length?"s":""} ${h.info_minified||"minified"}.${r}`)):S(`
${p+(h.info_noFilesProcessed||"No unminified JavaScript files processed")}.[0m`),o.length&&(S(`
${m+o.length} `+(h.info_file||"file")+`${1<o.length?"s":""} ${h.info_failedToMinify||"failed to minify"}:${r}`),o.forEach(e=>S(e))),0!=e?.length&&($.copy&&1==e?.length?(console.log(`
${d}${e[0].code}[0m`),S(`
${h.info_copying||"Copying to clipboard"}...`),t.writeSync(e[0].code)):(S(`
${h.info_writing||"Writing to file"}${1<e?.length?"s":""}...`),e?.forEach(({code:e,srcPath:o,relPath:n})=>{let t,r;if(!$.relativeOutput&&n){let e=c.resolve(process.cwd(),a||"min"),i=c.dirname(n);t="."!=i?c.join(e,i):e,r=c.basename(o,".js")+`${$.noFilenameChange?"":".min"}.js`}else t=c.join(c.dirname(o),a.endsWith(".js")?c.dirname(a):a||"min"),r=(a.endsWith(".js")&&s.endsWith(".js")?c.basename(a).replace(/(\.min)?\.js$/,""):c.basename(o,".js"))+`${$.noFilenameChange?"":".min"}.js`;let i=c.join(t,r);l.existsSync(t)||l.mkdirSync(t,{recursive:!0}),l.writeFileSync(i,e,"utf8"),S(`  ${f}âœ“[0m `+c.relative(process.cwd(),i))})))}}function _(n){return new Promise((o,e)=>{var i=n.match(/^([^:]+):\/\//)[1];/^https?$/.test(i)||e(new Error(`${h.error_invalidURL||"Invalid URL"}.`)),require(i).get(n,e=>{let i="";e.on("data",e=>i+=e),e.on("end",()=>o({json:()=>JSON.parse(i)}))}).on("error",e)})}function v(e=["header","usage","pathArgs","flags","paramOptions","infoCmds"]){var i=`[106m[30m ${pkgName.replace(/^@[^/]+\//,"")} [0m `;let o={header:[`
â”œ `+i+(h.appCopyright||copyright),i+(h.prefix_source||"Source")+": "+srcURL],usage:[`
${d}o ${h.helpSection_usage||"Usage"}:[0m`,` ${d}Â» ${f}${cmdFormat}[0m`],pathArgs:[`
${d}o ${h.helpSection_pathArgs||"Path arguments"}:[0m`," [inputPath]                         "+`${h.inputPathDesc_main||"Path to JS file or directory containing JS files to be minified"}, `+`${h.inputPathDesc_extra||"relative to the current working directory"}.`," [outputPath]                        "+`${h.outputPathDesc_main||"Path to file or directory where minified files will be stored"}, `+`${h.outputPathDesc_extra||"relative to original file location (if not provided, min/ is used)"}.`],flags:[`
${d}o ${h.helpSection_flags||"Boolean options"}:[0m`," -n, --dry-run                       "+`${h.optionDesc_dryRun||"Don't actually minify the file(s), just show if they will be processed"}.`,` -d, --include-dotfolders            ${h.optionDesc_dotfolders||"Include dotfolders in file search"}.`,` -D, --include-dotfiles              ${h.optionDesc_dotfiles||"Include dotfiles in file search"}.`,` -R, --no-recursion                  ${h.optionDesc_noRecursion||"Disable recursive file searching"}.`,` -M, --no-mangle                     ${h.optionDesc_noMangle||"Disable mangling names"}.`," -X, --no-filename-change            "+(h.optionDesc_noFilenameChange||"Disable changing file extension to .min.js"),` -i, --rewrite-imports               ${h.optionDesc_rewriteImports||"Update import paths from .js to .min.js"}.`,` -c, --copy                          ${h.optionDesc_copy||"Copy minified code to clipboard instead of writing to file if single source file is processed"}.`,` -r, --relative-output               ${h.optionDesc_relativeOutput||"Output files relative to each source file instead of to input root"}.`,` -q, --quiet                         ${h.optionDesc_quiet||"Suppress all logging except errors"}.`],paramOptions:[`
${d}o ${h.helpSection_paramOptions||"Parameter options"}:[0m`,`--ignores="dir/,file1.js,file2.js"   ${h.optionDesc_ignores||"Files/directories to exclude from minification"}.`,`--comment="comment"                  ${h.optionDesc_commentMain||"Prepend header comment to minified code"}.`+` ${h.optionDesc_commentExtra||"Separate by line using '\\n'"}.`],infoCmds:[`
${d}o ${h.helpSection_infoCmds||"Info commands"}:[0m`," -h, --help                          "+(h.optionDesc_help||"Display help screen."),` -v, --version                       ${h.optionDesc_version||"Show version number"}.`]};e.forEach(s=>o[s]?.forEach(i=>{{var r=/header|usage/.test(s)?1:37;let o=process.stdout.columns||80,n=[],e=i.match(/\S+|\s+/g),t="";e.forEach(e=>{var i=o-(n.length?r:0);t.length+"| ".length+e.length>i&&(n.push(n.length?t.trimStart():t),t=""),t+=e}),n.push(n.length?t.trimStart():t),n.forEach((e,i)=>console.info("| "+(0==i?e:" ".repeat(r)+e)))}})),console.info(`
${h.info_moreHelp||"For more help"}, ${h.info_visit||"visit"}: ${d}${docURL}[0m`)}function j(){console.info(`
${h.info_moreHelp||"For more help"}, ${h.info_type||"type"} minify-js --help' ${h.info_or||"or"} ${h.info_visit||"visit"}
${d}${docURL}[0m`)}function S(e){$.quietMode||console.info(e)}})();