#!/usr/bin/env node
const fs=require("fs"),path=require("path"),uglifyJS=require("uglify-js"),nc="[0m",br="[1;91m",by="[1;33m",bg="[1;92m",[inputArg="",outputArg=""]=process.argv.slice(2).filter(i=>!i.startsWith("-")).map(i=>i.replace(/^\/*/,"")),inputPath=path.resolve(__dirname,inputArg),config=(inputArg&&!fs.existsSync(inputPath)&&(console.error(`
${br}Error: First arg must be an existing file or directory.`+`
${inputPath} does not exist.`+nc+"\n\nExample valid command: \n>> minify-js . output.min.js"),process.exit(1)),{includeDotFolders:process.argv.some(i=>/--?include-dot-?folders?/.test(i)),includeDotFiles:process.argv.some(i=>/--?include-dot-?files?/.test(i))}),jsFiles=[];inputArg.endsWith(".js")?jsFiles.push(inputPath):function t(n){fs.readdirSync(n).forEach(i=>{var e=path.resolve(n,i);!fs.statSync(e).isDirectory()||"node_modules"==i||!config.includeDotFolders&&i.startsWith(".")?!/\.js(?<!\.min\.js)$/.test(i)||!config.includeDotFiles&&i.startsWith(".")||jsFiles.push(e):t(e)})}(inputPath);let minifiedCnt=0;console.log(""),jsFiles.forEach(i=>{console.info(`Minifying ${i}...`);var e=path.join(path.dirname(i),/so?u?rce?$/.test(path.dirname(i))?"../min":outputArg.endsWith(".js")?path.dirname(outputArg):outputArg||"min"),t=(outputArg.endsWith(".js")&&inputArg.endsWith(".js")?path.basename(outputArg).replace(/(\.min)?\.js$/,""):path.basename(i,".js"))+".min.js",t=path.join(e,t),i=uglifyJS.minify(fs.readFileSync(i,"utf8")).code;fs.existsSync(e)||fs.mkdirSync(e,{recursive:!0}),fs.writeFileSync(t,i,"utf8"),minifiedCnt++}),minifiedCnt?(console.info(`
${bg}Minification complete!`+nc),console.info(`${minifiedCnt} file${1<minifiedCnt?"s":""} minified.`)):console.info(by+"No unminified JavaScript files found."+nc);