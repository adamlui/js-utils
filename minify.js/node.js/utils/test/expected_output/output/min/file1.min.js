#!/usr/bin/env node
const o=require("fs"),r=require("path"),n=require("uglify-js"),e="[0m",i="[1;91m",s="[1;33m",t="[1;92m",[c="",l=""]=process.argv.slice(2).filter(e=>!e.startsWith("-")).map(e=>e.replace(/^\/*/,"")),a=r.resolve(__dirname,c),d=(c&&!o.existsSync(a)&&(console.error(`
${i}Error: First arg must be an existing file or directory.`+`
${a} does not exist.`+e+"\n\nExample valid command: \n>> minify-js . output.min.js"),process.exit(1)),{includeDotFolders:process.argv.some(e=>/--?include-dot-?folders?/.test(e)),includeDotFiles:process.argv.some(e=>/--?include-dot-?files?/.test(e))}),m=[];c.endsWith(".js")?m.push(a):function s(n){o.readdirSync(n).forEach(e=>{var i=r.resolve(n,e);!o.statSync(i).isDirectory()||"node_modules"==e||!d.includeDotFolders&&e.startsWith(".")?!/\.js(?<!\.min\.js)$/.test(e)||!d.includeDotFiles&&e.startsWith(".")||m.push(i):s(i)})}(a);let f=0;console.log(""),m.forEach(e=>{console.info(`Minifying ${e}...`);var i=r.join(r.dirname(e),/so?u?rce?$/.test(r.dirname(e))?"../min":l.endsWith(".js")?r.dirname(l):l||"min"),s=(l.endsWith(".js")&&c.endsWith(".js")?r.basename(l).replace(/(\.min)?\.js$/,""):r.basename(e,".js"))+".min.js",s=r.join(i,s),e=n.minify(o.readFileSync(e,"utf8")).code;o.existsSync(i)||o.mkdirSync(i,{recursive:!0}),o.writeFileSync(s,e,"utf8"),f++}),f?(console.info(`
${t}Minification complete!`+e),console.info(`${f} file${1<f?"s":""} minified.`)):console.info(s+"No unminified JavaScript files found."+e);