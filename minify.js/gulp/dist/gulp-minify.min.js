/**
 *  © 2024 Adam Lui under the MIT license.
 *  Source: https://code.minify-js.org/gulp
 *  Documentation: https://docs.minify-js.org/gulp
 */
let minifyJS=require("@adamlui/minify.js"),fs=require("fs"),path=require("path"),Transform=require("stream").Transform;function minify(r,s,t={}){if(t={recursive:!0,verbose:!0,dotFolders:!1,dotFiles:!1,mangle:!0,comment:"",...t},!r&&!s)return new Transform({objectMode:!0,transform(e,i,n){var r;e.isBuffer()&&(t.verbose&&console.info(`minify() » Minifying ${e.path}...`),r=minifyJS.minify(e.contents.toString(),{}),e.contents=Buffer.from(r.code)),this.push(e),n()}});var o=path.resolve(process.cwd(),r);if(r&&!fs.existsSync(o))console.error("\nminify() » ERROR: 1st: First argument can only be an existing file or directory."),console.info(`
minify() » ${o} does not exist.`);else{let{mangle:e,comment:i,...n}=t;(r.endsWith(".js")?[o]:minifyJS.findJS(o,n)).map(e=>minifyJS.minify(e,t)).filter(e=>!e.error)?.forEach(({code:e,srcPath:i})=>{var n=path.join(path.dirname(i),(/so?u?rce?$/.test(path.dirname(i))?"../":"")+(s.endsWith(".js")?path.dirname(s):s||"min")),i=(s.endsWith(".js")&&r.endsWith(".js")?path.basename(s).replace(/(\.min)?\.js$/,""):path.basename(i,".js"))+".min.js",i=path.join(n,i);fs.existsSync(n)||fs.mkdirSync(n,{recursive:!0}),fs.writeFileSync(i,e,"utf8")})}}module.exports=minify;